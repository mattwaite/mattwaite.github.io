<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 26 Advanced rvest | Sports Data Analysis and Visualization</title>
  <meta name="description" content="This book is the companion to the University of Nebraska-Lincoln’s SPMC350 course in the College of Journalism and Mass Communications." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 26 Advanced rvest | Sports Data Analysis and Visualization" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book is the companion to the University of Nebraska-Lincoln’s SPMC350 course in the College of Journalism and Mass Communications." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 26 Advanced rvest | Sports Data Analysis and Visualization" />
  
  <meta name="twitter:description" content="This book is the companion to the University of Nebraska-Lincoln’s SPMC350 course in the College of Journalism and Mass Communications." />
  

<meta name="author" content="By Matt Waite" />


<meta name="date" content="2019-07-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro-to-rvest.html"/>
<link rel="next" href="annotations.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160712129-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-160712129-1');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sports Data Analysis and Visualization</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Throwing cold water on hot takes</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements-and-conventions"><i class="fa fa-check"></i><b>1.1</b> Requirements and Conventions</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.2</b> About this book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-very-basics.html"><a href="the-very-basics.html"><i class="fa fa-check"></i><b>2</b> The very basics</a><ul>
<li class="chapter" data-level="2.1" data-path="the-very-basics.html"><a href="the-very-basics.html#adding-libraries-part-1"><i class="fa fa-check"></i><b>2.1</b> Adding libraries, part 1</a></li>
<li class="chapter" data-level="2.2" data-path="the-very-basics.html"><a href="the-very-basics.html#adding-libraries-part-2"><i class="fa fa-check"></i><b>2.2</b> Adding libraries, part 2</a></li>
<li class="chapter" data-level="2.3" data-path="the-very-basics.html"><a href="the-very-basics.html#notebooks"><i class="fa fa-check"></i><b>2.3</b> Notebooks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html"><i class="fa fa-check"></i><b>3</b> Data, structures and types</a><ul>
<li class="chapter" data-level="3.1" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#rows-and-columns"><i class="fa fa-check"></i><b>3.1</b> Rows and columns</a></li>
<li class="chapter" data-level="3.2" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#types"><i class="fa fa-check"></i><b>3.2</b> Types</a></li>
<li class="chapter" data-level="3.3" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#a-simple-way-to-get-data"><i class="fa fa-check"></i><b>3.3</b> A simple way to get data</a></li>
<li class="chapter" data-level="3.4" data-path="data-structures-and-types.html"><a href="data-structures-and-types.html#cleaning-the-data"><i class="fa fa-check"></i><b>3.4</b> Cleaning the data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="aggregates.html"><a href="aggregates.html"><i class="fa fa-check"></i><b>4</b> Aggregates</a><ul>
<li class="chapter" data-level="4.1" data-path="aggregates.html"><a href="aggregates.html#basic-data-analysis-group-by-and-count"><i class="fa fa-check"></i><b>4.1</b> Basic data analysis: Group By and Count</a></li>
<li class="chapter" data-level="4.2" data-path="aggregates.html"><a href="aggregates.html#other-aggregates-mean-and-median"><i class="fa fa-check"></i><b>4.2</b> Other aggregates: Mean and median</a></li>
<li class="chapter" data-level="4.3" data-path="aggregates.html"><a href="aggregates.html#even-more-aggregates"><i class="fa fa-check"></i><b>4.3</b> Even more aggregates</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="mutating-data.html"><a href="mutating-data.html"><i class="fa fa-check"></i><b>5</b> Mutating data</a><ul>
<li class="chapter" data-level="5.1" data-path="mutating-data.html"><a href="mutating-data.html#a-more-complex-example"><i class="fa fa-check"></i><b>5.1</b> A more complex example</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="filters-and-selections.html"><a href="filters-and-selections.html"><i class="fa fa-check"></i><b>6</b> Filters and selections</a><ul>
<li class="chapter" data-level="6.1" data-path="filters-and-selections.html"><a href="filters-and-selections.html#selecting-data-to-make-it-easier-to-read"><i class="fa fa-check"></i><b>6.1</b> Selecting data to make it easier to read</a></li>
<li class="chapter" data-level="6.2" data-path="filters-and-selections.html"><a href="filters-and-selections.html#using-conditional-filters-to-set-limits"><i class="fa fa-check"></i><b>6.2</b> Using conditional filters to set limits</a></li>
<li class="chapter" data-level="6.3" data-path="filters-and-selections.html"><a href="filters-and-selections.html#top-list"><i class="fa fa-check"></i><b>6.3</b> Top list</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="transforming-data.html"><a href="transforming-data.html"><i class="fa fa-check"></i><b>7</b> Transforming data</a><ul>
<li class="chapter" data-level="7.1" data-path="transforming-data.html"><a href="transforming-data.html#making-long-data-wide"><i class="fa fa-check"></i><b>7.1</b> Making long data wide</a></li>
<li class="chapter" data-level="7.2" data-path="transforming-data.html"><a href="transforming-data.html#why-this-matters"><i class="fa fa-check"></i><b>7.2</b> Why this matters</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="significance-tests.html"><a href="significance-tests.html"><i class="fa fa-check"></i><b>8</b> Significance tests</a><ul>
<li class="chapter" data-level="8.1" data-path="significance-tests.html"><a href="significance-tests.html#accepting-the-null-hypothesis"><i class="fa fa-check"></i><b>8.1</b> Accepting the null hypothesis</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="correlations-and-regression.html"><a href="correlations-and-regression.html"><i class="fa fa-check"></i><b>9</b> Correlations and regression</a><ul>
<li class="chapter" data-level="9.1" data-path="correlations-and-regression.html"><a href="correlations-and-regression.html#a-more-predictive-example"><i class="fa fa-check"></i><b>9.1</b> A more predictive example</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>10</b> Multiple regression</a></li>
<li class="chapter" data-level="11" data-path="residuals.html"><a href="residuals.html"><i class="fa fa-check"></i><b>11</b> Residuals</a><ul>
<li class="chapter" data-level="11.1" data-path="residuals.html"><a href="residuals.html#penalties"><i class="fa fa-check"></i><b>11.1</b> Penalties</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="z-scores.html"><a href="z-scores.html"><i class="fa fa-check"></i><b>12</b> Z-scores</a><ul>
<li class="chapter" data-level="12.1" data-path="z-scores.html"><a href="z-scores.html#calculating-a-z-score-in-r"><i class="fa fa-check"></i><b>12.1</b> Calculating a Z score in R</a></li>
<li class="chapter" data-level="12.2" data-path="z-scores.html"><a href="z-scores.html#writing-about-z-scores"><i class="fa fa-check"></i><b>12.2</b> Writing about z-scores</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html"><i class="fa fa-check"></i><b>13</b> Intro to ggplot</a><ul>
<li class="chapter" data-level="13.1" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#the-bar-chart"><i class="fa fa-check"></i><b>13.1</b> The bar chart</a></li>
<li class="chapter" data-level="13.2" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#scales"><i class="fa fa-check"></i><b>13.2</b> Scales</a></li>
<li class="chapter" data-level="13.3" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#styling"><i class="fa fa-check"></i><b>13.3</b> Styling</a></li>
<li class="chapter" data-level="13.4" data-path="intro-to-ggplot.html"><a href="intro-to-ggplot.html#one-last-trick-coord-flip"><i class="fa fa-check"></i><b>13.4</b> One last trick: coord flip</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="stacked-bar-charts.html"><a href="stacked-bar-charts.html"><i class="fa fa-check"></i><b>14</b> Stacked bar charts</a></li>
<li class="chapter" data-level="15" data-path="waffle-charts.html"><a href="waffle-charts.html"><i class="fa fa-check"></i><b>15</b> Waffle charts</a><ul>
<li class="chapter" data-level="15.1" data-path="waffle-charts.html"><a href="waffle-charts.html#waffles-two-ways-part-1"><i class="fa fa-check"></i><b>15.1</b> Waffles two ways: Part 1</a></li>
<li class="chapter" data-level="15.2" data-path="waffle-charts.html"><a href="waffle-charts.html#waffles-two-ways-part-2"><i class="fa fa-check"></i><b>15.2</b> Waffles two ways: Part 2</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="line-charts.html"><a href="line-charts.html"><i class="fa fa-check"></i><b>16</b> Line charts</a><ul>
<li class="chapter" data-level="16.1" data-path="line-charts.html"><a href="line-charts.html#this-is-too-simple."><i class="fa fa-check"></i><b>16.1</b> This is too simple.</a></li>
<li class="chapter" data-level="16.2" data-path="line-charts.html"><a href="line-charts.html#but-what-if-i-wanted-to-add-a-lot-of-lines."><i class="fa fa-check"></i><b>16.2</b> But what if I wanted to add a lot of lines.</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="step-charts.html"><a href="step-charts.html"><i class="fa fa-check"></i><b>17</b> Step charts</a></li>
<li class="chapter" data-level="18" data-path="ridge-charts.html"><a href="ridge-charts.html"><i class="fa fa-check"></i><b>18</b> Ridge charts</a></li>
<li class="chapter" data-level="19" data-path="dumbbell-and-lollipop-charts.html"><a href="dumbbell-and-lollipop-charts.html"><i class="fa fa-check"></i><b>19</b> Dumbbell and lollipop charts</a><ul>
<li class="chapter" data-level="19.1" data-path="dumbbell-and-lollipop-charts.html"><a href="dumbbell-and-lollipop-charts.html#dumbbell-plots"><i class="fa fa-check"></i><b>19.1</b> Dumbbell plots</a></li>
<li class="chapter" data-level="19.2" data-path="dumbbell-and-lollipop-charts.html"><a href="dumbbell-and-lollipop-charts.html#lollipop-charts"><i class="fa fa-check"></i><b>19.2</b> Lollipop charts</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="scatterplots.html"><a href="scatterplots.html"><i class="fa fa-check"></i><b>20</b> Scatterplots</a></li>
<li class="chapter" data-level="21" data-path="facet-wraps.html"><a href="facet-wraps.html"><i class="fa fa-check"></i><b>21</b> Facet wraps</a><ul>
<li class="chapter" data-level="21.1" data-path="facet-wraps.html"><a href="facet-wraps.html#facet-grid-vs-facet-wraps"><i class="fa fa-check"></i><b>21.1</b> Facet grid vs facet wraps</a></li>
<li class="chapter" data-level="21.2" data-path="facet-wraps.html"><a href="facet-wraps.html#other-types"><i class="fa fa-check"></i><b>21.2</b> Other types</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>22</b> Tables</a><ul>
<li class="chapter" data-level="22.1" data-path="tables.html"><a href="tables.html#exporting-tables"><i class="fa fa-check"></i><b>22.1</b> Exporting tables</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="bubble-charts.html"><a href="bubble-charts.html"><i class="fa fa-check"></i><b>23</b> Bubble charts</a></li>
<li class="chapter" data-level="24" data-path="circular-bar-plots.html"><a href="circular-bar-plots.html"><i class="fa fa-check"></i><b>24</b> Circular bar plots</a></li>
<li class="chapter" data-level="25" data-path="intro-to-rvest.html"><a href="intro-to-rvest.html"><i class="fa fa-check"></i><b>25</b> Intro to rvest</a><ul>
<li class="chapter" data-level="25.1" data-path="intro-to-rvest.html"><a href="intro-to-rvest.html#a-slightly-more-complicated-example"><i class="fa fa-check"></i><b>25.1</b> A slightly more complicated example</a></li>
<li class="chapter" data-level="25.2" data-path="intro-to-rvest.html"><a href="intro-to-rvest.html#an-even-more-complicated-example"><i class="fa fa-check"></i><b>25.2</b> An even more complicated example</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="advanced-rvest.html"><a href="advanced-rvest.html"><i class="fa fa-check"></i><b>26</b> Advanced rvest</a><ul>
<li class="chapter" data-level="26.1" data-path="advanced-rvest.html"><a href="advanced-rvest.html#one-last-bit"><i class="fa fa-check"></i><b>26.1</b> One last bit</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="annotations.html"><a href="annotations.html"><i class="fa fa-check"></i><b>27</b> Annotations</a></li>
<li class="chapter" data-level="28" data-path="finishing-touches-part-1.html"><a href="finishing-touches-part-1.html"><i class="fa fa-check"></i><b>28</b> Finishing touches, part 1</a><ul>
<li class="chapter" data-level="28.1" data-path="finishing-touches-part-1.html"><a href="finishing-touches-part-1.html#graphics-vs-visual-stories"><i class="fa fa-check"></i><b>28.1</b> Graphics vs visual stories</a></li>
<li class="chapter" data-level="28.2" data-path="finishing-touches-part-1.html"><a href="finishing-touches-part-1.html#getting-ggplot-closer-to-output"><i class="fa fa-check"></i><b>28.2</b> Getting ggplot closer to output</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="finishing-touches-2.html"><a href="finishing-touches-2.html"><i class="fa fa-check"></i><b>29</b> Finishing Touches 2</a></li>
<li class="chapter" data-level="30" data-path="plotly.html"><a href="plotly.html"><i class="fa fa-check"></i><b>30</b> Plotly</a><ul>
<li class="chapter" data-level="30.1" data-path="plotly.html"><a href="plotly.html#publishing-using-plotly"><i class="fa fa-check"></i><b>30.1</b> Publishing using Plotly</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>31</b> Clustering</a><ul>
<li class="chapter" data-level="31.1" data-path="clustering.html"><a href="clustering.html#advanced-metrics"><i class="fa fa-check"></i><b>31.1</b> Advanced metrics</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html"><i class="fa fa-check"></i><b>32</b> Rtweet and Text Analysis</a><ul>
<li class="chapter" data-level="32.1" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#prerequisites"><i class="fa fa-check"></i><b>32.1</b> Prerequisites</a><ul>
<li class="chapter" data-level="32.1.1" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#tools-for-text-analysis"><i class="fa fa-check"></i><b>32.1.1</b> Tools for text analysis</a></li>
<li class="chapter" data-level="32.1.2" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#working-with-string-data"><i class="fa fa-check"></i><b>32.1.2</b> Working with string data</a></li>
</ul></li>
<li class="chapter" data-level="32.2" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#verifying-your-account-to-access-twitter-data"><i class="fa fa-check"></i><b>32.2</b> Verifying your account to access Twitter data</a></li>
<li class="chapter" data-level="32.3" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#the-data-used-here"><i class="fa fa-check"></i><b>32.3</b> The data used here</a></li>
<li class="chapter" data-level="32.4" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#data-exploration"><i class="fa fa-check"></i><b>32.4</b> Data Exploration</a></li>
<li class="chapter" data-level="32.5" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#cleaning-data-for-analysis"><i class="fa fa-check"></i><b>32.5</b> Cleaning data for analysis</a><ul>
<li class="chapter" data-level="32.5.1" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#fixing-the-date-and-focusing-only-on-game-tweets"><i class="fa fa-check"></i><b>32.5.1</b> Fixing the date and focusing only on game tweets</a></li>
</ul></li>
<li class="chapter" data-level="32.6" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#number-of-tweets-throughout-the-game"><i class="fa fa-check"></i><b>32.6</b> Number of tweets throughout the game</a></li>
<li class="chapter" data-level="32.7" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#tidying-the-text-data-for-analysis-applying-the-sentiment-scores"><i class="fa fa-check"></i><b>32.7</b> Tidying the text data for analysis, applying the sentiment scores</a><ul>
<li class="chapter" data-level="32.7.1" data-path="rtweet-and-text-analysis.html"><a href="rtweet-and-text-analysis.html#example-2---nebraskas-loss-to-purdue-what-were-fans-sentiments-towards-this-loss"><i class="fa fa-check"></i><b>32.7.1</b> Example 2 - Nebraska’s loss to Purdue, what were fan’s sentiments towards this loss?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="33" data-path="arranging-multiple-plots-together.html"><a href="arranging-multiple-plots-together.html"><i class="fa fa-check"></i><b>33</b> Arranging multiple plots together</a></li>
<li class="chapter" data-level="34" data-path="encircling-points-on-a-scatterplot.html"><a href="encircling-points-on-a-scatterplot.html"><i class="fa fa-check"></i><b>34</b> Encircling points on a scatterplot</a><ul>
<li class="chapter" data-level="34.1" data-path="encircling-points-on-a-scatterplot.html"><a href="encircling-points-on-a-scatterplot.html#a-different-more-local-example"><i class="fa fa-check"></i><b>34.1</b> A different, more local example</a></li>
</ul></li>
<li class="chapter" data-level="35" data-path="bump-charts.html"><a href="bump-charts.html"><i class="fa fa-check"></i><b>35</b> Bump charts</a></li>
<li class="chapter" data-level="36" data-path="text-cleaning.html"><a href="text-cleaning.html"><i class="fa fa-check"></i><b>36</b> Text cleaning</a><ul>
<li class="chapter" data-level="36.1" data-path="text-cleaning.html"><a href="text-cleaning.html#stripping-out-text"><i class="fa fa-check"></i><b>36.1</b> Stripping out text</a></li>
<li class="chapter" data-level="36.2" data-path="text-cleaning.html"><a href="text-cleaning.html#another-example-splitting-columns"><i class="fa fa-check"></i><b>36.2</b> Another example: splitting columns</a></li>
</ul></li>
<li class="chapter" data-level="37" data-path="assignments.html"><a href="assignments.html"><i class="fa fa-check"></i><b>37</b> Assignments</a></li>
<li class="chapter" data-level="38" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>38</b> Appendix</a><ul>
<li class="chapter" data-level="38.1" data-path="appendix.html"><a href="appendix.html#how-to-get-help-in-this-class"><i class="fa fa-check"></i><b>38.1</b> How to get help in this class</a></li>
</ul></li>
<li class="chapter" data-level="39" data-path="simulations.html"><a href="simulations.html"><i class="fa fa-check"></i><b>39</b> Simulations</a><ul>
<li class="chapter" data-level="39.1" data-path="simulations.html"><a href="simulations.html#cold-streaks"><i class="fa fa-check"></i><b>39.1</b> Cold streaks</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Sports Data Analysis and Visualization</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-rvest" class="section level1">
<h1><span class="header-section-number">Chapter 26</span> Advanced rvest</h1>
<p>With the chapter, we learned how to grab one table from one page. But what if you needed more than that? What if you needed hundreds of tables from hundreds of pages? What if you needed to combine one table on one page into a bigger table, but hundreds of times. There’s a way to do this, it just takes patience, a lot of logic, a lot of debugging and, for me, a fair bit of swearing.</p>
<p>So what we are after are game by game stats for each college basketball team in America.</p>
<p><a href="https://www.sports-reference.com/cbb/seasons/2019-school-stats.html">We can see from this page</a> that each team is linked. If we follow each link, we get a ton of tables. But they aren’t what we need. There’s a link to gamelogs underneath the team names.</p>
<p>So we can see from this that we’ve got some problems.</p>
<ol style="list-style-type: decimal">
<li>The team name isn’t in the table. Nor is the conference.</li>
<li>There’s a date we’ll have to deal with.</li>
<li>Non-standard headers and a truly huge number of fields.</li>
<li>And how do we get each one of those urls without having to copy them all into some horrible list?</li>
</ol>
<p>So let’s start with that last question first and grab libraries we need.</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="advanced-rvest.html#cb420-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb420-2"><a href="advanced-rvest.html#cb420-2"></a><span class="kw">library</span>(rvest)</span>
<span id="cb420-3"><a href="advanced-rvest.html#cb420-3"></a><span class="kw">library</span>(lubridate)</span></code></pre></div>
<p>First things first, we need to grab the url to each team from that first link.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="advanced-rvest.html#cb421-1"></a>url &lt;-<span class="st"> &quot;https://www.sports-reference.com/cbb/seasons/2019-school-stats.html&quot;</span></span></code></pre></div>
<p>But notice first, we don’t want to grab the table. The table doesn’t help us. We need to grab the only <em>link</em> in the table. So we can do that by using the table xpath node, then grabbing the anchor tags in the table, then get only the link out of them (instead of the linked text).</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="advanced-rvest.html#cb422-1"></a>schools &lt;-<span class="st"> </span>url <span class="op">%&gt;%</span></span>
<span id="cb422-2"><a href="advanced-rvest.html#cb422-2"></a><span class="st">  </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span></span>
<span id="cb422-3"><a href="advanced-rvest.html#cb422-3"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;basic_school_stats&quot;]&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb422-4"><a href="advanced-rvest.html#cb422-4"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb422-5"><a href="advanced-rvest.html#cb422-5"></a><span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&#39;href&#39;</span>)</span></code></pre></div>
<p>Notice we now have a list called schools with … 353 elements. That’s the number of teams in college basketball, so we’re off to a good start. Here’s what the fourth element is.</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="advanced-rvest.html#cb423-1"></a>schools[<span class="dv">4</span>]</span></code></pre></div>
<pre><code>## [1] &quot;/cbb/schools/alabama-am/2019.html&quot;</code></pre>
<p>So note, that’s the relative path to Alabama A&amp;M’s team page. By relative path, I mean it doesn’t have the root domain. So we need to add that to each request or we’ll get no where.</p>
<p>So that’s a problem to note.</p>
<p>Before we solve that, let’s just make sure we can get one page and get what we need.</p>
<p>We’ll scrape Abilene Christian.</p>
<p>To merge all this into one big table, we need to grab the team name and their conference and merge it into the table. But those values come from somewhere else. The scraping works just about the same, but instead of html_table you use html_text.</p>
<p>So the first part of this is reading the html of the page so we don’t do that for each element – we just do it once so as to not overwhelm their servers.</p>
<p>The second part is we’re grabbing the team name based on it’s location in the page.</p>
<p>Third: The conference.</p>
<p>Fourth is the table itself, noting to ignore the headers. The last bit fixes the headers, removes the garbage header data from the table, converts the data to numbers, fixes the date and mutates a team and conference value. It looks like a lot, and it took a bit of twiddling to get it done, but it’s no different from what you did for your last homework.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="advanced-rvest.html#cb425-1"></a>page &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&quot;https://www.sports-reference.com/cbb/schools/abilene-christian/2019-gamelogs.html&quot;</span>)</span>
<span id="cb425-2"><a href="advanced-rvest.html#cb425-2"></a>  </span>
<span id="cb425-3"><a href="advanced-rvest.html#cb425-3"></a>team &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span></span>
<span id="cb425-4"><a href="advanced-rvest.html#cb425-4"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;meta&quot;]/div[2]/h1/span[2]&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb425-5"><a href="advanced-rvest.html#cb425-5"></a><span class="st">  </span><span class="kw">html_text</span>()</span>
<span id="cb425-6"><a href="advanced-rvest.html#cb425-6"></a></span>
<span id="cb425-7"><a href="advanced-rvest.html#cb425-7"></a>conference &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span></span>
<span id="cb425-8"><a href="advanced-rvest.html#cb425-8"></a><span class="st">    </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;meta&quot;]/div[2]/p[1]/a&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb425-9"><a href="advanced-rvest.html#cb425-9"></a><span class="st">    </span><span class="kw">html_text</span>()</span>
<span id="cb425-10"><a href="advanced-rvest.html#cb425-10"></a></span>
<span id="cb425-11"><a href="advanced-rvest.html#cb425-11"></a>table &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span></span>
<span id="cb425-12"><a href="advanced-rvest.html#cb425-12"></a><span class="st">  </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;sgl-basic&quot;]&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb425-13"><a href="advanced-rvest.html#cb425-13"></a><span class="st">  </span><span class="kw">html_table</span>(<span class="dt">header=</span><span class="ot">FALSE</span>)</span>
<span id="cb425-14"><a href="advanced-rvest.html#cb425-14"></a></span>
<span id="cb425-15"><a href="advanced-rvest.html#cb425-15"></a>table &lt;-<span class="st"> </span>table[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">Game=</span>X1, <span class="dt">Date=</span>X2, <span class="dt">HomeAway=</span>X3, <span class="dt">Opponent=</span>X4, <span class="dt">W_L=</span>X5, <span class="dt">TeamScore=</span>X6, <span class="dt">OpponentScore=</span>X7, <span class="dt">TeamFG=</span>X8, <span class="dt">TeamFGA=</span>X9, <span class="dt">TeamFGPCT=</span>X10, <span class="dt">Team3P=</span>X11, <span class="dt">Team3PA=</span>X12, <span class="dt">Team3PPCT=</span>X13, <span class="dt">TeamFT=</span>X14, <span class="dt">TeamFTA=</span>X15, <span class="dt">TeamFTPCT=</span>X16, <span class="dt">TeamOffRebounds=</span>X17, <span class="dt">TeamTotalRebounds=</span>X18, <span class="dt">TeamAssists=</span>X19, <span class="dt">TeamSteals=</span>X20, <span class="dt">TeamBlocks=</span>X21, <span class="dt">TeamTurnovers=</span>X22, <span class="dt">TeamPersonalFouls=</span>X23, <span class="dt">Blank=</span>X24, <span class="dt">OpponentFG=</span>X25, <span class="dt">OpponentFGA=</span>X26, <span class="dt">OpponentFGPCT=</span>X27, <span class="dt">Opponent3P=</span>X28, <span class="dt">Opponent3PA=</span>X29, <span class="dt">Opponent3PPCT=</span>X30, <span class="dt">OpponentFT=</span>X31, <span class="dt">OpponentFTA=</span>X32, <span class="dt">OpponentFTPCT=</span>X33, <span class="dt">OpponentOffRebounds=</span>X34, <span class="dt">OpponentTotalRebounds=</span>X35, <span class="dt">OpponentAssists=</span>X36, <span class="dt">OpponentSteals=</span>X37, <span class="dt">OpponentBlocks=</span>X38, <span class="dt">OpponentTurnovers=</span>X39, <span class="dt">OpponentPersonalFouls=</span>X40) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Game <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Game <span class="op">!=</span><span class="st"> &quot;G&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Team=</span>team) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Team, <span class="op">-</span>Date, <span class="op">-</span>Opponent, <span class="op">-</span>HomeAway, <span class="op">-</span>W_L), as.numeric) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">ymd</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Team=</span>team, <span class="dt">Conference=</span>conference)</span></code></pre></div>
<p>Now what we’re left with is how do we do this for ALL the teams. We need to send 353 requests to their servers to get each page. And each url is not the one we have – we need to alter it.</p>
<p>First we have to add the root domain to each request. And, each request needs to go to /2019-gamelogs.html instead of /2019.html. If you look at the urls two the page we have and the page we need, that’s all that changes.</p>
<p>What we’re going to use is what is known in programming as a loop. We can loop through a list and have it do something to each element in the loop. And once it’s done, we can move on to the next thing.</p>
<p>Think of it like a program that will go though a list of your classmates and ask each one of them for their year in school. It will start at one end of the list and move through asking each one “What year in school are you?” and will move on after getting an answer.</p>
<p>Except we want to take a url, add something to it, alter it, then request it and grab a bunch of data from it. Once we’re done doing all that, we’ll take all that info and cram it into a bigger dataset and then move on to the next one. Here’s what that looks like:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="advanced-rvest.html#cb426-1"></a>uri &lt;-<span class="st"> &quot;https://www.sports-reference.com&quot;</span></span>
<span id="cb426-2"><a href="advanced-rvest.html#cb426-2"></a></span>
<span id="cb426-3"><a href="advanced-rvest.html#cb426-3"></a>logs &lt;-<span class="st"> </span><span class="kw">tibble</span>()</span>
<span id="cb426-4"><a href="advanced-rvest.html#cb426-4"></a></span>
<span id="cb426-5"><a href="advanced-rvest.html#cb426-5"></a><span class="cf">for</span> (i <span class="cf">in</span> schools){</span>
<span id="cb426-6"><a href="advanced-rvest.html#cb426-6"></a>  log_url &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;/2019.html&quot;</span>,<span class="st">&quot;/2019-gamelogs.html&quot;</span>, i)</span>
<span id="cb426-7"><a href="advanced-rvest.html#cb426-7"></a>  school_url &lt;-<span class="st"> </span><span class="kw">paste</span>(uri, log_url, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>)  <span class="co"># creating the url to fetch</span></span>
<span id="cb426-8"><a href="advanced-rvest.html#cb426-8"></a>  </span>
<span id="cb426-9"><a href="advanced-rvest.html#cb426-9"></a>  page &lt;-<span class="st"> </span><span class="kw">read_html</span>(school_url)</span>
<span id="cb426-10"><a href="advanced-rvest.html#cb426-10"></a>  </span>
<span id="cb426-11"><a href="advanced-rvest.html#cb426-11"></a>  team &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span></span>
<span id="cb426-12"><a href="advanced-rvest.html#cb426-12"></a><span class="st">    </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;meta&quot;]/div[2]/h1/span[2]&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb426-13"><a href="advanced-rvest.html#cb426-13"></a><span class="st">    </span><span class="kw">html_text</span>()</span>
<span id="cb426-14"><a href="advanced-rvest.html#cb426-14"></a>  </span>
<span id="cb426-15"><a href="advanced-rvest.html#cb426-15"></a>  conference &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span></span>
<span id="cb426-16"><a href="advanced-rvest.html#cb426-16"></a><span class="st">    </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;meta&quot;]/div[2]/p[1]/a&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb426-17"><a href="advanced-rvest.html#cb426-17"></a><span class="st">    </span><span class="kw">html_text</span>()</span>
<span id="cb426-18"><a href="advanced-rvest.html#cb426-18"></a></span>
<span id="cb426-19"><a href="advanced-rvest.html#cb426-19"></a>  table &lt;-<span class="st"> </span>page <span class="op">%&gt;%</span></span>
<span id="cb426-20"><a href="advanced-rvest.html#cb426-20"></a><span class="st">    </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;sgl-basic&quot;]&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb426-21"><a href="advanced-rvest.html#cb426-21"></a><span class="st">    </span><span class="kw">html_table</span>(<span class="dt">header=</span><span class="ot">FALSE</span>)</span>
<span id="cb426-22"><a href="advanced-rvest.html#cb426-22"></a></span>
<span id="cb426-23"><a href="advanced-rvest.html#cb426-23"></a>table &lt;-<span class="st"> </span>table[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">Game=</span>X1, <span class="dt">Date=</span>X2, <span class="dt">HomeAway=</span>X3, <span class="dt">Opponent=</span>X4, <span class="dt">W_L=</span>X5, <span class="dt">TeamScore=</span>X6, <span class="dt">OpponentScore=</span>X7, <span class="dt">TeamFG=</span>X8, <span class="dt">TeamFGA=</span>X9, <span class="dt">TeamFGPCT=</span>X10, <span class="dt">Team3P=</span>X11, <span class="dt">Team3PA=</span>X12, <span class="dt">Team3PPCT=</span>X13, <span class="dt">TeamFT=</span>X14, <span class="dt">TeamFTA=</span>X15, <span class="dt">TeamFTPCT=</span>X16, <span class="dt">TeamOffRebounds=</span>X17, <span class="dt">TeamTotalRebounds=</span>X18, <span class="dt">TeamAssists=</span>X19, <span class="dt">TeamSteals=</span>X20, <span class="dt">TeamBlocks=</span>X21, <span class="dt">TeamTurnovers=</span>X22, <span class="dt">TeamPersonalFouls=</span>X23, <span class="dt">Blank=</span>X24, <span class="dt">OpponentFG=</span>X25, <span class="dt">OpponentFGA=</span>X26, <span class="dt">OpponentFGPCT=</span>X27, <span class="dt">Opponent3P=</span>X28, <span class="dt">Opponent3PA=</span>X29, <span class="dt">Opponent3PPCT=</span>X30, <span class="dt">OpponentFT=</span>X31, <span class="dt">OpponentFTA=</span>X32, <span class="dt">OpponentFTPCT=</span>X33, <span class="dt">OpponentOffRebounds=</span>X34, <span class="dt">OpponentTotalRebounds=</span>X35, <span class="dt">OpponentAssists=</span>X36, <span class="dt">OpponentSteals=</span>X37, <span class="dt">OpponentBlocks=</span>X38, <span class="dt">OpponentTurnovers=</span>X39, <span class="dt">OpponentPersonalFouls=</span>X40) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Game <span class="op">!=</span><span class="st"> &quot;&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Game <span class="op">!=</span><span class="st"> &quot;G&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Team=</span>team) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>Team, <span class="op">-</span>Date, <span class="op">-</span>Opponent, <span class="op">-</span>HomeAway, <span class="op">-</span>W_L), as.numeric) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw">ymd</span>(Date)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Team=</span>team, <span class="dt">Conference=</span>conference)</span>
<span id="cb426-24"><a href="advanced-rvest.html#cb426-24"></a></span>
<span id="cb426-25"><a href="advanced-rvest.html#cb426-25"></a>  logs &lt;-<span class="st"> </span><span class="kw">rbind</span>(logs, table)  <span class="co"># binding them all together</span></span>
<span id="cb426-26"><a href="advanced-rvest.html#cb426-26"></a>  <span class="kw">Sys.sleep</span>(<span class="dv">5</span>)  <span class="co"># Sys.sleep(3) pauses the loop for 3s so as not to overwhelm website&#39;s server</span></span>
<span id="cb426-27"><a href="advanced-rvest.html#cb426-27"></a>}</span></code></pre></div>
<p>The magic here is in <code>for (i in schools){</code>. What that says is for each iterator in schools – for each school in schools – do what follows each time. So we take the code we wrote for one school and use it for every school.</p>
<p>This part:</p>
<pre><code>  log_url &lt;- gsub(&quot;/2019.html&quot;,&quot;/2019-gamelogs.html&quot;, i)
  school_url &lt;- paste(uri, log_url, sep=&quot;&quot;)  # creating the url to fetch
  
  page &lt;- read_html(school_url)</code></pre>
<p><code>log_url</code> is what changes our school page url to our logs url, and <code>school_url</code> is taking that log url and the root domain and merging them together to create the complete url. Then, page just reads that url we created.</p>
<p>What follows that is taken straight from our example of just doing one.</p>
<p>The last bits are using rbind to take our data and mash it into a bigger table, over and over and over again until we have them all in a single table. Then, we tell our scraper to wait a few seconds because we don’t want our script to machine gun requests at their server as fast as it can go. That’s a guaranteed way to get them to block scrapers, and could knock them off the internet. Aggressive scrapers aren’t cool. Don’t do it.</p>
<p>Lastly, we write it out to a csv file.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="advanced-rvest.html#cb428-1"></a><span class="kw">write.csv</span>(logs, <span class="st">&quot;logs.csv&quot;</span>)</span></code></pre></div>
<p>So with a little programming knowhow, a little bit of problem solving and the stubbornness not to quit on it, you can get a whole lot of data scattered all over the place with not a lot of code.</p>
<div id="one-last-bit" class="section level2">
<h2><span class="header-section-number">26.1</span> One last bit</h2>
<p>Most tables that Sports Reference sites have are in plain vanilla HTML. But some of them – particularly player based stuff – are hidden with a little trick. The site puts the data in a comment – where a browser will ignore it – and then uses javascript to interpret the commented data. To a human on the page, it looks the same. To a browswer or a scraper, it’s invisible. You’ll get errors. How do you get around it?</p>
<ol style="list-style-type: decimal">
<li>Scrape the comments.</li>
<li>Turn the comment into text.</li>
<li>Then read that text as html.</li>
<li>Proceed as normal.</li>
</ol>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="advanced-rvest.html#cb429-1"></a>h &lt;-<span class="st"> </span><span class="kw">read_html</span>(<span class="st">&#39;https://www.baseball-reference.com/leagues/MLB/2017-standard-pitching.shtml&#39;</span>)</span>
<span id="cb429-2"><a href="advanced-rvest.html#cb429-2"></a></span>
<span id="cb429-3"><a href="advanced-rvest.html#cb429-3"></a>df &lt;-<span class="st"> </span>h <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="dt">xpath =</span> <span class="st">&#39;//comment()&#39;</span>) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># select comment nodes</span></span>
<span id="cb429-4"><a href="advanced-rvest.html#cb429-4"></a><span class="st">    </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># extract comment text</span></span>
<span id="cb429-5"><a href="advanced-rvest.html#cb429-5"></a><span class="st">    </span><span class="kw">paste</span>(<span class="dt">collapse =</span> <span class="st">&#39;&#39;</span>) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># collapse to a single string</span></span>
<span id="cb429-6"><a href="advanced-rvest.html#cb429-6"></a><span class="st">    </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># reparse to HTML</span></span>
<span id="cb429-7"><a href="advanced-rvest.html#cb429-7"></a><span class="st">    </span><span class="kw">html_node</span>(<span class="st">&#39;table&#39;</span>) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># select the desired table</span></span>
<span id="cb429-8"><a href="advanced-rvest.html#cb429-8"></a><span class="st">    </span><span class="kw">html_table</span>() </span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro-to-rvest.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="annotations.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SportsData.pdf", "SportsData.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
