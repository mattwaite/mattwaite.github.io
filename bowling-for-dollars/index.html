<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Atari Bowling - Sideways</title>
    <style>
        /* General page setup */
        body {
            background-color: #333;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        /* The main game window */
        #game-container {
            width: 480px;
            height: 320px;
            background-color: #A0522D; /* Atari brown background */
            position: relative;
            overflow: hidden;
            border: 2px solid #000;
            transform: scale(1.5); /* Scale up the game */
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }

        /* The blue lines defining the lane - FIXED */
        .lane-line {
            position: absolute;
            width: 100%; /* Should be 100% wide */
            height: 4px;  /* And 4px tall */
            left: 0;
            background-color: #0000AA; /* Atari blue */
        }
        #line-top {
            top: 40px; /* Match GUTTER_TOP */
        }
        #line-bottom {
            bottom: 40px; /* Match GUTTER_BOTTOM */
        }

        /* The player's bowler - FIXED (image removed) */
        #bowler {
            position: absolute;
            width: 24px; 
            height: 32px;
            left: 20px; /* Start on the left */
            top: 144px; /* Start in the middle vertically */
              background-image: url('bowler.png');
              background-size: cover;
            background-color: #00C000; /* Placeholder green */
        }

        /* The bowling ball */
        #ball {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #0000AA; /* Blue ball */
            border-radius: 50%;
            left: 70px; /* Start in front of bowler */
            top: 155px;
            display: none; /* Hidden until thrown */
        }

        /* A single bowling pin */
        .pin {
            position: absolute;
            width: 8px; /* Rotated dollar bill */
            height: 16px; 
            background-color: #008000; /* Green for dollar bill */
            border: 1px solid #004000; /* Darker green border */
            box-sizing: border-box; 
        }

        /* The scoreboard display */
        #scoreboard {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            color: #00F000; /* Green score */
            letter-spacing: 4px;
        }

        /* Instructions text */
        #controls {
            margin-top: 60px; /* Account for game scaling */
            text-align: center;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="lane-line" id="line-top"></div>
        <div class="lane-line" id="line-bottom"></div>
        
        <div id="scoreboard">00</div>

        <div id="ball"></div>
        <div id="bowler"></div>
    </div>

    <div id="controls">
        <p>Use <strong>ArrowUp / ArrowDown</strong> to move bowler.</p>
        <p>Press <strong>Space</strong> to roll.</p>
        <p>Use <strong>ArrowUp / ArrowDown</strong> while ball is rolling to "hook".</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get all game elements
            const gameContainer = document.getElementById('game-container');
            const bowler = document.getElementById('bowler');
            const ball = document.getElementById('ball');
            const scoreboard = document.getElementById('scoreboard');

            // Game constants
            const LANE_WIDTH = 480;
            const LANE_HEIGHT = 320;
            const BOWLER_WIDTH = 24;
            const BOWLER_HEIGHT = 32;
            const BALL_WIDTH = 10;
            const BALL_HEIGHT = 10;
            const PIN_WIDTH = 8;
            const PIN_HEIGHT = 16;
            
            const GUTTER_TOP = 40;  // Top boundary
            const GUTTER_BOTTOM = 280; // Bottom boundary (320 - 40)
            const PIN_AREA_LEFT = 350; // X-coordinate for pins
            const PIN_CENTER_Y = 160; // Center of the lane

            // Game state variables
            let bowlerX = 20; 
            let bowlerY = 144; 
            let ballX = 0;
            let ballY = 0;
            let ballDx = 5; // Ball's horizontal velocity
            let ballDy = 0; // Ball's vertical "hook" velocity
            
            let rolling = false;
            let score = 0;
            let pins = [];
            let ballCount = 0;
            let frame = 1;

            // Pin layout - FIXED (pins point towards bowler)
            const pinPositions = [
                // Row 1 (Front)
                { x: PIN_AREA_LEFT + 10, y: PIN_CENTER_Y - (PIN_HEIGHT/2) }, // Pin 1 
                // Row 2
                { x: PIN_AREA_LEFT + 20, y: PIN_CENTER_Y - 10 - (PIN_HEIGHT/2) }, // Pin 2
                { x: PIN_AREA_LEFT + 20, y: PIN_CENTER_Y + 10 - (PIN_HEIGHT/2) }, // Pin 3
                // Row 3
                { x: PIN_AREA_LEFT + 30, y: PIN_CENTER_Y - 20 - (PIN_HEIGHT/2) }, // Pin 4
                { x: PIN_AREA_LEFT + 30, y: PIN_CENTER_Y - (PIN_HEIGHT/2) },       // Pin 5
                { x: PIN_AREA_LEFT + 30, y: PIN_CENTER_Y + 20 - (PIN_HEIGHT/2) }, // Pin 6
                // Row 4 (Back)
                { x: PIN_AREA_LEFT + 40, y: PIN_CENTER_Y - 30 - (PIN_HEIGHT/2) }, // Pin 7
                { x: PIN_AREA_LEFT + 40, y: PIN_CENTER_Y - 10 - (PIN_HEIGHT/2) }, // Pin 8
                { x: PIN_AREA_LEFT + 40, y: PIN_CENTER_Y + 10 - (PIN_HEIGHT/2) }, // Pin 9
                { x: PIN_AREA_LEFT + 40, y: PIN_CENTER_Y + 30 - (PIN_HEIGHT/2) }  // Pin 10
            ];

            // --- Game Setup Functions ---

            function createPins() {
                pins.forEach(p => p.element.remove());
                pins = [];

                pinPositions.forEach((pos, index) => {
                    const pinElement = document.createElement('div');
                    pinElement.className = 'pin';
                    pinElement.id = `pin-${index}`;
                    pinElement.style.left = `${pos.x}px`;
                    pinElement.style.top = `${pos.y}px`;
                    gameContainer.appendChild(pinElement);
                    
                    pins.push({
                        element: pinElement,
                        x: pos.x,
                        y: pos.y,
                        width: PIN_WIDTH,
                        height: PIN_HEIGHT,
                        isUp: true 
                    });
                });
            }

            function resetBowler() {
                bowlerX = 20;
                bowlerY = 144;
                bowler.style.left = `${bowlerX}px`;
                bowler.style.top = `${bowlerY}px`;
                
                // Reset ball state
                ball.style.display = 'none';
                rolling = false;
                ballDy = 0; // Reset hook
                ballX = 70; // Reset ball's logical X position
                ballY = 155; // Reset ball's logical Y position
            }

            function resetFrame() {
                createPins();
                resetBowler();
                ballCount = 0; // Frame is reset, so ball count is 0
            }

            // --- nextBall function - FIXED ---
            function nextBall() {
                // Ball count increments AFTER the roll.
                // ballCount = 0 -> roll -> ballCount = 1 (after 1st ball)
                // ballCount = 1 -> roll -> ballCount = 2 (after 2nd ball)
                ballCount++; 

                // Check how many pins are down in total
                const pinsDown = pins.filter(p => !p.isUp).length;

                // Frame ends if:
                // 1. It was a strike (10 pins down on the first ball)
                // 2. It was the second ball (ballCount is now 2)
                if ((pinsDown === 10 && ballCount === 1) || ballCount === 2) {
                    alert(`Frame ${frame} over! Total Pins: ${score}\nResetting for next frame.`);
                    frame++;
                    resetFrame(); // This will reset pins, bowler, and ballCount to 0
                } else {
                    // It was the first ball, and not a strike.
                    // Just reset the bowler for the second roll.
                    resetBowler();
                }
            }
            
            // --- Input Handling ---

            document.addEventListener('keydown', (e) => {
                if (rolling) {
                    // --- Ball Hooking Controls ---
                    if (e.key === 'ArrowUp') {
                        ballDy = -1; // Hook up
                    } else if (e.key === 'ArrowDown') {
                        ballDy = 1; // Hook down
                    }
                } else {
                    // --- Bowler Movement Controls ---
                    if (e.key === 'ArrowUp') {
                        bowlerY = Math.max(GUTTER_TOP, bowlerY - 5);
                        bowler.style.top = `${bowlerY}px`;
                    } else if (e.key === 'ArrowDown') {
                        bowlerY = Math.min(GUTTER_BOTTOM - BOWLER_HEIGHT, bowlerY + 5);
                        bowler.style.top = `${bowlerY}px`;
                    } else if (e.key === ' ' || e.key === 'Spacebar') {
                        rollBall();
                    }
                }
            });

            document.addEventListener('keyup', (e) => {
                if (rolling) {
                    if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
                        ballDy = 0;
                    }
                }
            });

            // --- Game Logic ---

            function rollBall() {
                if (rolling) return;
                rolling = true;
                
                // Set ball's starting position based on bowler
                ballX = 70; // Set logical X to start
                ballY = bowlerY + (BOWLER_HEIGHT / 2) - (BALL_HEIGHT / 2);
                
                ball.style.left = `${ballX}px`;
                ball.style.top = `${ballY}px`;
                ball.style.display = 'block';

                gameLoop();
            }

            function checkCollision(a, b) {
                return (
                    a.x < b.x + b.width &&
                    a.x + a.width > b.x &&
                    a.y < b.y + b.height &&
                    a.y + a.height > b.y
                );
            }

            function updateScore(pinsHit) {
                score += pinsHit;
                scoreboard.textContent = String(score).padStart(2, '0');
            }

            // --- Main Game Loop ---
            function gameLoop() {
                if (!rolling) return; // Stop loop if not rolling

                // 1. Move ball
                ballX += Math.abs(ballDx); // Move right
                ballY += ballDy; // Apply hook (up/down)

                // 2. Update ball's DOM position
                ball.style.left = `${ballX}px`;
                ball.style.top = `${ballY}px`;

                // 3. Check for collision with pins
                let pinsHitThisFrame = 0;
                const ballRect = { x: ballX, y: ballY, width: BALL_WIDTH, height: BALL_HEIGHT };

                pins.forEach(pin => {
                    if (pin.isUp) {
                        const pinRect = { x: pin.x, y: pin.y, width: pin.width, height: pin.height };
                        if (checkCollision(ballRect, pinRect)) {
                            pin.isUp = false; 
                            pin.element.style.display = 'none'; 
                            pinsHitThisFrame++;
                        }
                    }
                });
                
                // 4. Update score
                if (pinsHitThisFrame > 0) {
                    updateScore(pinsHitThisFrame);
                }

                // 5. Check for end of roll
                if (ballX > LANE_WIDTH) {
                    rolling = false; // Stop rolling
                    nextBall(); // Go to the next ball/frame logic
                } else {
                    // Keep the loop going
                    requestAnimationFrame(gameLoop);
                }
            }

            // --- Initialize Game ---
            resetFrame(); 
        });
    </script>
</body>
</html>