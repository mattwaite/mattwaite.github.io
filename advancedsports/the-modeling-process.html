<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 The modeling process | Advanced Sports Data Analysis</title>
  <meta name="description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 The modeling process | Advanced Sports Data Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 The modeling process | Advanced Sports Data Analysis" />
  
  <meta name="twitter:description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  

<meta name="author" content="By Matt Waite" />


<meta name="date" content="2021-01-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="multiple-regression-and-feature-engineering.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Sports Data Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements-and-conventions"><i class="fa fa-check"></i><b>1.1</b> Requirements and Conventions</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.2</b> About this book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-modeling-process.html"><a href="the-modeling-process.html"><i class="fa fa-check"></i><b>2</b> The modeling process</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-modeling-process.html"><a href="the-modeling-process.html#setting-up-the-modeling-process"><i class="fa fa-check"></i><b>2.1</b> Setting up the modeling process</a></li>
<li class="chapter" data-level="2.2" data-path="the-modeling-process.html"><a href="the-modeling-process.html#predicting-based-on-the-model"><i class="fa fa-check"></i><b>2.2</b> Predicting based on the model</a></li>
<li class="chapter" data-level="2.3" data-path="the-modeling-process.html"><a href="the-modeling-process.html#predicting-data-we-havent-seen-before"><i class="fa fa-check"></i><b>2.3</b> Predicting data we haven’t seen before</a></li>
<li class="chapter" data-level="2.4" data-path="the-modeling-process.html"><a href="the-modeling-process.html#looking-locally"><i class="fa fa-check"></i><b>2.4</b> Looking locally</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multiple-regression-and-feature-engineering.html"><a href="multiple-regression-and-feature-engineering.html"><i class="fa fa-check"></i><b>3</b> Multiple regression and feature engineering</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multiple-regression-and-feature-engineering.html"><a href="multiple-regression-and-feature-engineering.html#a-multiple-regression-speed-run"><i class="fa fa-check"></i><b>3.1</b> A multiple regression speed run</a></li>
<li class="chapter" data-level="3.2" data-path="multiple-regression-and-feature-engineering.html"><a href="multiple-regression-and-feature-engineering.html#picking-what-moves-the-needle"><i class="fa fa-check"></i><b>3.2</b> Picking what moves the needle</a></li>
<li class="chapter" data-level="3.3" data-path="multiple-regression-and-feature-engineering.html"><a href="multiple-regression-and-feature-engineering.html#feature-engineering"><i class="fa fa-check"></i><b>3.3</b> Feature engineering</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html"><i class="fa fa-check"></i><b>4</b> Decision trees and random forests</a>
<ul>
<li class="chapter" data-level="4.1" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#an-intro-to-pre-processsing"><i class="fa fa-check"></i><b>4.1</b> An intro to pre-processsing</a></li>
<li class="chapter" data-level="4.2" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#using-our-possession-metrics"><i class="fa fa-check"></i><b>4.2</b> Using our possession metrics</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="xgboost.html"><a href="xgboost.html"><i class="fa fa-check"></i><b>5</b> XGBoost</a></li>
<li class="chapter" data-level="6" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>6</b> Support Vector Machines</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Sports Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-modeling-process" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> The modeling process</h1>
<p>The Nebraska men’s basketball team in 2019-2020 was … not good. The first season of Fred Hoiberg brought excitement and a lot of new faces to Lincoln, but the product on the floor didn’t go as hoped. The team finished 7-25.</p>
<p>In the off-season, The Mayor turned over the roster (again), bringing on players who couldn’t play the previous season because of transfer rules and some new transfers who could play.</p>
<p>As of this writing, the team has won 4 games and lost 7, and they’ve lost every Big Ten game they’ve played. But watch the team, and it’s obvious they are better. But – and this is a question we’ll explore over multiple chapters – how much better?</p>
<p>Let’s start by looking at predicting how many points the team should score given how well they are shooting. And we’ll use this as a chance to look at linear regression modeling.</p>
<p>If you don’t have them already installed, we’ll need the tidyverse and tidymodels for this book.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="the-modeling-process.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb2-2"><a href="the-modeling-process.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidymodels&quot;</span>)</span></code></pre></div>
<p>After they’ve installed – and if you haven’t this will take a bit – load them.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="the-modeling-process.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="the-modeling-process.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code></pre></div>
<p>For this walkthrough, we’re going to use a dataset of college basketball games from the 14-15 season through the 20-21 season as of Jan. 8.</p>
<pre><p><strong>For this walkthrough:</strong></p><p><a href="http://mattwaite.github.io/sportsdatafiles/cbblogs1521.csv">
  <button class="btn btn-danger"><i class="fa fa-save"></i> Download csv file</button>
</a></p></pre>
<p>Let’s load this data and take a look at it.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="the-modeling-process.html#cb4-1" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/cbblogs1521.csv&quot;</span>)</span></code></pre></div>
<p>Any time we’re building models, we need to explore the data a bit. We can learn about our data before we try anything, which helps us learn more. A common first step? Histograms of the columns you’re looking at. A histogram groups data into bins and counts up the number of rows in that fall in the bin. Let’s first look at the histogram of points a team has scored (TeamScore).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="the-modeling-process.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">data=</span>games, <span class="fu">aes</span>(<span class="at">x=</span>TeamScore))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="advancedsportsdataanalysis_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>First, look at the highest bar. It’s in the upper 60s, with a line near the top around 70. So a lot of college basketball teams scored that area in a game.</p>
<p>We’re also looking at shooting perentage, so let’s make a histogram for that.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="the-modeling-process.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">data=</span>games, <span class="fu">aes</span>(<span class="at">x=</span>TeamFGPCT))</span></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<pre><code>## Warning: Removed 2 rows containing non-finite values (stat_bin).</code></pre>
<p><img src="advancedsportsdataanalysis_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>First, note that 2 rows were removed for containing “non-finite values.” What does that mean? Two games don’t have shooting percentages. They got a score, but the data is missing. It’s not going to matter for modeling, so we should drop those games so they don’t cause us problems later. Second, most teams are shooting in the mid-40s per game for all shots from the floor (that’s both two point and three point shots combined).</p>
<p>We can’t model nothing, so we need to drop the games with no stats. We can do that with a simple filter.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="the-modeling-process.html#cb10-1" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> games <span class="sc">%&gt;%</span> <span class="fu">filter</span>(TeamFGPCT<span class="sc">&gt;</span><span class="dv">0</span>)</span></code></pre></div>
<p>Now we begin the process of creating a model. Modeling in data science has a <strong>ton</strong> of details, but the process for each model type is similar.</p>
<ol style="list-style-type: decimal">
<li>Split your data into training and testing data sets. A common split is 80/20.</li>
<li>Train the model on the training dataset.</li>
<li>Evaluate the model on the training data.</li>
<li>Apply the model to the testing data.</li>
<li>Evaluate the model on the test data.</li>
</ol>
<p>From there, it’s how you want to use the model. We’ll walk through a simple example here, using the simplest model – a linear model.</p>
<p>Linear models are something you’ve understood since you took middle school math and learned the equation of a line. Remember y = mx + b? It’s back. And, unlike what you complained bitterly in middle school, it’s very, very useful.</p>
<p>What a linear model says, in words is that we can predict y if we multiply a value – a coefficient – by our x value offset with b, which is really the y-intercept, but think of it like where the line starts. What we’re trying to do here is predict how many points a team should score given their shooting prowess as a team. Or, expressed as y = mx + b: points = TeamFGPCT * ? + some starting point. Think of some starting point as what the score should be if the TeamFGPCT is zero. Should be zero, right? Intuitively, yes, but it won’t always work out so easily.</p>
<div id="setting-up-the-modeling-process" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Setting up the modeling process</h2>
<p>With most modeling tasks we need to start with setting a random number seed to aid our random splitting of data into training and testing.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="the-modeling-process.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code></pre></div>
<p>Random numbers play a large role in a lot of data science algorithms, so setting one helps our reproducibility.</p>
<p>After that, we split our data. There’s a number of ways to do this – R has a bunch and you’ll find all kinds of examples online – but Tidymodels has made this easy.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="the-modeling-process.html#cb12-1" aria-hidden="true" tabindex="-1"></a>game_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(games, <span class="at">prop =</span> .<span class="dv">8</span>)</span>
<span id="cb12-2"><a href="the-modeling-process.html#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="the-modeling-process.html#cb12-3" aria-hidden="true" tabindex="-1"></a>game_split</span></code></pre></div>
<pre><code>## &lt;Analysis/Assess/Total&gt;
## &lt;48108/12026/60134&gt;</code></pre>
<p>What does this mean? It says that <code>initial_split</code> divided the data into 48,108 games in analysis (or training), 12,026 into assess (or test), of the 60,134 total records in the dataset. But the split object isn’t useful to us. We need to assign them to dataframes. We do so like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="the-modeling-process.html#cb14-1" aria-hidden="true" tabindex="-1"></a>game_train <span class="ot">&lt;-</span> <span class="fu">training</span>(game_split)</span>
<span id="cb14-2"><a href="the-modeling-process.html#cb14-2" aria-hidden="true" tabindex="-1"></a>game_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(game_split)</span></code></pre></div>
<p>Now we have two dataframes – game_train and game_test – that we can now use for modeling.</p>
<p>First step to making a model is to set what type of model this will be. We’re going to name our model object – lm_model works because this is a linear model. We’ll use the linear_reg function in parsnip (the modeling library in Tidymodels) and set the engine to “lm.”</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="the-modeling-process.html#cb15-1" aria-hidden="true" tabindex="-1"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="the-modeling-process.html#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>)</span></code></pre></div>
<p>We can get a peek at lm_model and make sure we did everything right by just typing it and executing.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="the-modeling-process.html#cb16-1" aria-hidden="true" tabindex="-1"></a>lm_model</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Computational engine: lm</code></pre>
<p>Now, let’s fit a linear model to our data. We’ll name the fitted model fit_lm and we’ll take our model object that we just created and fit it using the fit function. What goes in the fit function can be read like this:</p>
<p><code>TeamScore is approximately modeled by TeamFGPCT</code></p>
<p>The only thing left is to specify the dataset.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="the-modeling-process.html#cb18-1" aria-hidden="true" tabindex="-1"></a>fit_lm <span class="ot">&lt;-</span> lm_model <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="the-modeling-process.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(TeamScore <span class="sc">~</span> TeamFGPCT, <span class="at">data =</span> game_train)</span></code></pre></div>
<p>Let’s take a look at what the fitted model object tells us about our data.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="the-modeling-process.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(fit_lm, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 x 7
##   term        estimate std.error statistic p.value conf.low conf.high
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)     16.0     0.254      63.0       0     15.5      16.5
## 2 TeamFGPCT      126.      0.570     221.        0    125.      127.</code></pre>
<p>The two most important things to see here are the terms and the estimates. Start with TeamFGPCT. What that says is for every 10 percentage points of shooting percentage, a team should score 12.6 points. <em>HOWEVER</em>, the intercept has something to say about this. What the intercept says is that a team with a big fat zero for shooting percentage is going to score just a hair short of 16 points.</p>
<p>Wait … how? Well, are field goals the only way to score in basketball? No. So there’s some of your non-zero intercept.</p>
<p>Think again about y = mx + b. We have our terms here: y is team score, m is 126.26, x is the team shooting percentage and b is 15.98997. Let’s pretend for a minute that you coached a team that shot 40 percent in college basketball. Our model predicts you would score about 66 points.</p>
<p>But look at the confidence intervals. So our model says you’d score 66, but we’re 95 percent sure the real number is going to be between 65 and 67.</p>
</div>
<div id="predicting-based-on-the-model" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Predicting based on the model</h2>
<p>Now, we can take the model predictions and bind them to our dataset. This will be a common step throughout this book so we can see what the model predicted vs what the real world produced.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="the-modeling-process.html#cb21-1" aria-hidden="true" tabindex="-1"></a>trainresults <span class="ot">&lt;-</span> game_train <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="the-modeling-process.html#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lm, game_train))</span></code></pre></div>
<p>Walking through this, we’re creating a dataframe called trainresults, which is game_train with the results of the predict function bound to it. The predict function takes two arguments – the fitted model and the dataset it is being applied to, which in this case is the same dataset. What will result is our game_train dataset with a new column: <code>.pred</code></p>
<p>Our first step in evaluating a linear model is to get the r-squared value. The yardstick library (part of Tidymodels) does this nicely. We tell it to produce <code>metrics</code> on a dataset, and we have to tell it what the real world result is (the truth column) and what the estimate column is (.pred).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="the-modeling-process.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(trainresults, <span class="at">truth =</span> TeamScore, <span class="at">estimate =</span> .pred)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       9.33 
## 2 rsq     standard       0.505
## 3 mae     standard       7.27</code></pre>
<p>We’ll get more into RMSE and MAE later. For now, focus on rsq or r-squared. What that says is that changes in shooting percentage account for 50.48 percent of the variation in team score. That’s pretty good. Not great, but for one stat, it’s not bad.</p>
<p>A way to look at this is with a scatterplot. The geom_smooth creates its own linear model and puts the line of best fit through our dots.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="the-modeling-process.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb24-2"><a href="the-modeling-process.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>games, <span class="fu">aes</span>(<span class="at">x=</span>TeamFGPCT, <span class="at">y=</span>TeamScore)) <span class="sc">+</span> </span>
<span id="cb24-3"><a href="the-modeling-process.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data=</span>games, <span class="fu">aes</span>(<span class="at">x=</span>TeamFGPCT, <span class="at">y=</span>TeamScore), <span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="advancedsportsdataanalysis_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>As you can see, there’s a lot of dots above the line and below the line. That gap is a called a residual. The residual is the actual thing minus the predicted thing. The truth minus our guess. A positive residual – in this case – is good. It means that player is scoring <em>more</em> than we’d predict they would. A negative residual means they’re not scoring as much as we’d expect.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="the-modeling-process.html#cb26-1" aria-hidden="true" tabindex="-1"></a>trainresults <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="the-modeling-process.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Residual =</span> TeamScore <span class="sc">-</span> .pred) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">Label =</span> <span class="fu">case_when</span>(</span>
<span id="cb26-3"><a href="the-modeling-process.html#cb26-3" aria-hidden="true" tabindex="-1"></a>    Residual <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Positive&quot;</span>,</span>
<span id="cb26-4"><a href="the-modeling-process.html#cb26-4" aria-hidden="true" tabindex="-1"></a>    Residual <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;Negative&quot;</span>)</span>
<span id="cb26-5"><a href="the-modeling-process.html#cb26-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb26-6"><a href="the-modeling-process.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb26-7"><a href="the-modeling-process.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>TeamFGPCT, <span class="at">y=</span>TeamScore, <span class="at">color=</span>Label)) <span class="sc">+</span> </span>
<span id="cb26-8"><a href="the-modeling-process.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x=</span>TeamFGPCT, <span class="at">y=</span>TeamScore), <span class="at">method=</span><span class="st">&quot;lm&quot;</span>, <span class="at">se=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## `geom_smooth()` using formula &#39;y ~ x&#39;</code></pre>
<p><img src="advancedsportsdataanalysis_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Residuals, aside from telling us who is and isn’t playing well, can tell us if a linear model is appropriate for this data. We can use a scatterplot to reveal this.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="the-modeling-process.html#cb28-1" aria-hidden="true" tabindex="-1"></a>trainresults <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="the-modeling-process.html#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Residual =</span> TeamScore <span class="sc">-</span> .pred) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="the-modeling-process.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb28-4"><a href="the-modeling-process.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>TeamFGPCT, <span class="at">y=</span>Residual))</span></code></pre></div>
<p><img src="advancedsportsdataanalysis_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>What we’re looking for is for the dots to be randomly spaced around the plot. It should look like someone spilled Skittles on the floor. This … does. It means a linear model is appropriate here.</p>
<p>More on that in the coming chapters.</p>
</div>
<div id="predicting-data-we-havent-seen-before" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Predicting data we haven’t seen before</h2>
<p>Now we can do the same thing, but with the test data.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="the-modeling-process.html#cb29-1" aria-hidden="true" tabindex="-1"></a>testresults <span class="ot">&lt;-</span> game_test <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="the-modeling-process.html#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lm, game_test))</span></code></pre></div>
<p>What do these metrics look like?</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="the-modeling-process.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(testresults, <span class="at">truth =</span> TeamScore, <span class="at">estimate =</span> .pred)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard       9.23 
## 2 rsq     standard       0.501
## 3 mae     standard       7.21</code></pre>
<p>If you look at the r-squared value, you’ll note that when we apply the same model to our test data, the amount of variance that we can explain goes down a little. It’s not much, so the model does a decent job of predicting data we haven’t seen before, which is the whole point of creating a model.</p>
</div>
<div id="looking-locally" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Looking locally</h2>
<p>We can get clearer picture of what these predictions look like if we look at something we know – like this season’s Nebraska team. What does the model say about how they are doing?</p>
<p>First, we can get Nebraska’s games with a filter.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="the-modeling-process.html#cb32-1" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> games <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Season <span class="sc">==</span> <span class="st">&quot;2020-2021&quot;</span>, Team <span class="sc">==</span> <span class="st">&quot;Nebraska&quot;</span>)</span>
<span id="cb32-2"><a href="the-modeling-process.html#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="the-modeling-process.html#cb32-3" aria-hidden="true" tabindex="-1"></a>nu</span></code></pre></div>
<pre><code>## # A tibble: 12 x 48
##    Season  Game Date       TeamFull Opponent HomeAway W_L   TeamScore
##    &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;     &lt;dbl&gt;
##  1 2020-…     1 2020-11-25 Nebrask… McNeese… &lt;NA&gt;     W           102
##  2 2020-…     2 2020-11-26 Nebrask… Nevada   &lt;NA&gt;     L            66
##  3 2020-…     3 2020-11-28 Nebrask… North D… &lt;NA&gt;     W            79
##  4 2020-…     4 2020-12-01 Nebrask… South D… &lt;NA&gt;     W            76
##  5 2020-…     5 2020-12-09 Nebrask… Georgia… &lt;NA&gt;     L            64
##  6 2020-…     6 2020-12-11 Nebrask… Creight… @        L            74
##  7 2020-…     7 2020-12-17 Nebrask… Doane C… &lt;NA&gt;     W           110
##  8 2020-…     8 2020-12-22 Nebrask… Wiscons… @        L            53
##  9 2020-…     9 2020-12-25 Nebrask… Michigan &lt;NA&gt;     L            69
## 10 2020-…    10 2020-12-30 Nebrask… Ohio St… @        L            54
## 11 2020-…    11 2021-01-02 Nebrask… Michiga… &lt;NA&gt;     L            77
## 12 2020-…    12 2021-01-10 Nebrask… Indiana  &lt;NA&gt;     L            76
## # … with 40 more variables: OpponentScore &lt;dbl&gt;, TeamFG &lt;dbl&gt;, TeamFGA &lt;dbl&gt;,
## #   TeamFGPCT &lt;dbl&gt;, Team3P &lt;dbl&gt;, Team3PA &lt;dbl&gt;, Team3PPCT &lt;dbl&gt;,
## #   TeamFT &lt;dbl&gt;, TeamFTA &lt;dbl&gt;, TeamFTPCT &lt;dbl&gt;, TeamOffRebounds &lt;dbl&gt;,
## #   TeamTotalRebounds &lt;dbl&gt;, TeamAssists &lt;dbl&gt;, TeamSteals &lt;dbl&gt;,
## #   TeamBlocks &lt;dbl&gt;, TeamTurnovers &lt;dbl&gt;, TeamPersonalFouls &lt;dbl&gt;,
## #   OpponentFG &lt;dbl&gt;, OpponentFGA &lt;dbl&gt;, OpponentFGPCT &lt;dbl&gt;, Opponent3P &lt;dbl&gt;,
## #   Opponent3PA &lt;dbl&gt;, Opponent3PPCT &lt;dbl&gt;, OpponentFT &lt;dbl&gt;,
## #   OpponentFTA &lt;dbl&gt;, OpponentFTPCT &lt;dbl&gt;, OpponentOffRebounds &lt;dbl&gt;,
## #   OpponentTotalRebounds &lt;dbl&gt;, OpponentAssists &lt;dbl&gt;, OpponentSteals &lt;dbl&gt;,
## #   OpponentBlocks &lt;dbl&gt;, OpponentTurnovers &lt;dbl&gt;, OpponentPersonalFouls &lt;dbl&gt;,
## #   URL &lt;chr&gt;, Conference &lt;chr&gt;, Team &lt;chr&gt;, TeamSRS &lt;dbl&gt;, TeamSOS &lt;dbl&gt;,
## #   OpponentSRS &lt;dbl&gt;, OpponentSOS &lt;dbl&gt;</code></pre>
<p>Now apply the model to the games.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="the-modeling-process.html#cb34-1" aria-hidden="true" tabindex="-1"></a>nupreds <span class="ot">&lt;-</span> nu <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="the-modeling-process.html#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">predict</span>(fit_lm, nu))</span></code></pre></div>
<p>To really see this clearly, we’ll calculate the residual, then sort by the residual. Where did the model miss the most, for good or bad?</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="the-modeling-process.html#cb35-1" aria-hidden="true" tabindex="-1"></a>nupreds <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="the-modeling-process.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Residual =</span> TeamScore <span class="sc">-</span> .pred) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="the-modeling-process.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Residual)) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="the-modeling-process.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Team, Opponent, TeamScore, .pred, Residual)</span></code></pre></div>
<pre><code>## # A tibble: 12 x 5
##    Team     Opponent           TeamScore .pred Residual
##    &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 Nebraska Doane College            110  85.9   24.1  
##  2 Nebraska McNeese State            102  79.1   22.9  
##  3 Nebraska Nevada                    66  52.6   13.4  
##  4 Nebraska South Dakota              76  66.5    9.51 
##  5 Nebraska North Dakota State        79  74.1    4.93 
##  6 Nebraska Michigan                  69  65.4    3.64 
##  7 Nebraska Creighton                 74  71.4    2.58 
##  8 Nebraska Indiana                   76  73.6    2.44 
##  9 Nebraska Ohio State                54  51.7    2.28 
## 10 Nebraska Georgia Tech              64  63.6    0.411
## 11 Nebraska Michigan State            77  78.0   -0.982
## 12 Nebraska Wisconsin                 53  58.0   -5.03</code></pre>
<p>What does this mean? It says the model predicted the team would score 86 against Doane and they put up 110, for a 24 point miss (residual). For most games, the prediction is within a few points – it nailed the Georgia Tech game - and we did worse against Wisconsin than the model would have guessed. We underperformed, in a manner of speaking.</p>
<p>Linear models are incredibly important to understand — they underpin many of the more advanced methods we’ll talk about going forward — so understanding them now is critical.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="multiple-regression-and-feature-engineering.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-modeling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["advancedsportsdataanalysis.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
