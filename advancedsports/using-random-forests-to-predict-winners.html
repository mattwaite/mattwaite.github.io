<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Using random forests to predict winners | Advanced Sports Data Analysis</title>
  <meta name="description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Using random forests to predict winners | Advanced Sports Data Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Using random forests to predict winners | Advanced Sports Data Analysis" />
  
  <meta name="twitter:description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  

<meta name="author" content="By Matt Waite" />


<meta name="date" content="2022-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="logistic-regression.html"/>
<link rel="next" href="xgboost-to-make-classifications.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Sports Data Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements-and-conventions"><i class="fa fa-check"></i><b>1.1</b> Requirements and Conventions</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.2</b> About this book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html"><i class="fa fa-check"></i><b>2</b> The modeling process and linear regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#feature-engineering"><i class="fa fa-check"></i><b>2.1</b> Feature engineering</a></li>
<li class="chapter" data-level="2.2" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#setting-up-the-modeling-process"><i class="fa fa-check"></i><b>2.2</b> Setting up the modeling process</a></li>
<li class="chapter" data-level="2.3" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#predicting-based-on-the-model"><i class="fa fa-check"></i><b>2.3</b> Predicting based on the model</a></li>
<li class="chapter" data-level="2.4" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#predicting-data-we-havent-seen-before"><i class="fa fa-check"></i><b>2.4</b> Predicting data we haven’t seen before</a></li>
<li class="chapter" data-level="2.5" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#looking-locally"><i class="fa fa-check"></i><b>2.5</b> Looking locally</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>3</b> Multiple regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multiple-regression.html"><a href="multiple-regression.html#a-multiple-regression-speed-run"><i class="fa fa-check"></i><b>3.1</b> A multiple regression speed run</a></li>
<li class="chapter" data-level="3.2" data-path="multiple-regression.html"><a href="multiple-regression.html#picking-what-moves-the-needle"><i class="fa fa-check"></i><b>3.2</b> Picking what moves the needle</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html"><i class="fa fa-check"></i><b>4</b> Decision trees and random forests</a>
<ul>
<li class="chapter" data-level="4.1" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#an-intro-to-pre-processing"><i class="fa fa-check"></i><b>4.1</b> An intro to pre-processing</a></li>
<li class="chapter" data-level="4.2" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#decision-trees"><i class="fa fa-check"></i><b>4.2</b> Decision trees</a></li>
<li class="chapter" data-level="4.3" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#random-forest"><i class="fa fa-check"></i><b>4.3</b> Random forest</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="xgboost.html"><a href="xgboost.html"><i class="fa fa-check"></i><b>5</b> XGBoost</a>
<ul>
<li class="chapter" data-level="5.1" data-path="xgboost.html"><a href="xgboost.html#hyperparameters"><i class="fa fa-check"></i><b>5.1</b> Hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>6</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="logistic-regression.html"><a href="logistic-regression.html#visualizing-the-decision-boundary"><i class="fa fa-check"></i><b>6.1</b> Visualizing the decision boundary</a></li>
<li class="chapter" data-level="6.2" data-path="logistic-regression.html"><a href="logistic-regression.html#the-logistic-regression"><i class="fa fa-check"></i><b>6.2</b> The logistic regression</a></li>
<li class="chapter" data-level="6.3" data-path="logistic-regression.html"><a href="logistic-regression.html#evaluating-the-fit"><i class="fa fa-check"></i><b>6.3</b> Evaluating the fit</a></li>
<li class="chapter" data-level="6.4" data-path="logistic-regression.html"><a href="logistic-regression.html#comparing-it-to-test-data"><i class="fa fa-check"></i><b>6.4</b> Comparing it to test data</a></li>
<li class="chapter" data-level="6.5" data-path="logistic-regression.html"><a href="logistic-regression.html#how-well-did-it-do-with-nebraska"><i class="fa fa-check"></i><b>6.5</b> How well did it do with Nebraska?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="using-random-forests-to-predict-winners.html"><a href="using-random-forests-to-predict-winners.html"><i class="fa fa-check"></i><b>7</b> Using random forests to predict winners</a>
<ul>
<li class="chapter" data-level="7.1" data-path="using-random-forests-to-predict-winners.html"><a href="using-random-forests-to-predict-winners.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="using-random-forests-to-predict-winners.html"><a href="using-random-forests-to-predict-winners.html#predicting-a-future-game"><i class="fa fa-check"></i><b>7.2</b> Predicting a future game</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="xgboost-to-make-classifications.html"><a href="xgboost-to-make-classifications.html"><i class="fa fa-check"></i><b>8</b> XGBoost to make classifications</a></li>
<li class="chapter" data-level="9" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>9</b> Support Vector Machines</a>
<ul>
<li class="chapter" data-level="9.1" data-path="support-vector-machines.html"><a href="support-vector-machines.html#logistic-regression-1"><i class="fa fa-check"></i><b>9.1</b> Logistic regression</a></li>
<li class="chapter" data-level="9.2" data-path="support-vector-machines.html"><a href="support-vector-machines.html#random-forest-1"><i class="fa fa-check"></i><b>9.2</b> Random forest</a></li>
<li class="chapter" data-level="9.3" data-path="support-vector-machines.html"><a href="support-vector-machines.html#support-vector-machine"><i class="fa fa-check"></i><b>9.3</b> Support Vector Machine</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Sports Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="using-random-forests-to-predict-winners" class="section level1" number="7">
<h1><span class="header-section-number">Chapter 7</span> Using random forests to predict winners</h1>
<p>And now we return to decision trees and random forests. Recall that tree-based algorithms are based on decision trees, which are very easy to understand. A random forest is, as the name implies, a large number of decision trees, and they use a random choice of inputs at each fork in the tree. The algorithm creates a large number of randomly selected training inputs, and randomly chooses the feature input for each branch, creating predictions. The goal is to create uncorrelated forests of trees. The trees all make predictions, and the wisdom of the crowds takes over. Now, instead of a regression problem where we predict a number, we’re predicting a classification – win or loss. Along with that is the probability that it’s a win or a loss.</p>
<p>Let’s get our libraries.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="using-random-forests-to-predict-winners.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb168-2"><a href="using-random-forests-to-predict-winners.html#cb168-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb168-3"><a href="using-random-forests-to-predict-winners.html#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb168-4"><a href="using-random-forests-to-predict-winners.html#cb168-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hoopR)</span>
<span id="cb168-5"><a href="using-random-forests-to-predict-winners.html#cb168-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-6"><a href="using-random-forests-to-predict-winners.html#cb168-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code></pre></div>
<p>And we’ll restore our feature engineering from logistic regression to compare.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="using-random-forests-to-predict-winners.html#cb169-1" aria-hidden="true" tabindex="-1"></a>teamgames <span class="ot">&lt;-</span> <span class="fu">load_mbb_team_box</span>(<span class="at">seasons =</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb169-2"><a href="using-random-forests-to-predict-winners.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(field_goals_made_field_goals_attempted, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;field_goals_made&quot;</span>,<span class="st">&quot;field_goals_attempted&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="using-random-forests-to-predict-winners.html#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(three_point_field_goals_made_three_point_field_goals_attempted, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;three_point_field_goals_made&quot;</span>,<span class="st">&quot;three_point_field_goals_attempted&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb169-4"><a href="using-random-forests-to-predict-winners.html#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(free_throws_made_free_throws_attempted, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;free_throws_made&quot;</span>,<span class="st">&quot;free_throws_attempted&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb169-5"><a href="using-random-forests-to-predict-winners.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">34</span>, as.numeric)</span>
<span id="cb169-6"><a href="using-random-forests-to-predict-winners.html#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="using-random-forests-to-predict-winners.html#cb169-7" aria-hidden="true" tabindex="-1"></a>teamstats <span class="ot">&lt;-</span> teamgames <span class="sc">%&gt;%</span> </span>
<span id="cb169-8"><a href="using-random-forests-to-predict-winners.html#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(team_short_display_name, season) <span class="sc">%&gt;%</span></span>
<span id="cb169-9"><a href="using-random-forests-to-predict-winners.html#cb169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(game_date) <span class="sc">%&gt;%</span></span>
<span id="cb169-10"><a href="using-random-forests-to-predict-winners.html#cb169-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb169-11"><a href="using-random-forests-to-predict-winners.html#cb169-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_score =</span> ((field_goals_made<span class="sc">-</span>three_point_field_goals_made) <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span> (three_point_field_goals_made<span class="sc">*</span><span class="dv">3</span>) <span class="sc">+</span> free_throws_made,</span>
<span id="cb169-12"><a href="using-random-forests-to-predict-winners.html#cb169-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_shooting_percentage =</span> (team_score <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>(field_goals_attempted <span class="sc">+</span> (.<span class="dv">44</span> <span class="sc">*</span> free_throws_attempted)))) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb169-13"><a href="using-random-forests-to-predict-winners.html#cb169-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnover_pct =</span> turnovers<span class="sc">/</span>(field_goals_attempted <span class="sc">+</span> <span class="fl">0.44</span> <span class="sc">*</span> free_throws_attempted <span class="sc">+</span> turnovers),</span>
<span id="cb169-14"><a href="using-random-forests-to-predict-winners.html#cb169-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">free_throw_factor =</span> free_throws_made<span class="sc">/</span>field_goals_attempted,</span>
<span id="cb169-15"><a href="using-random-forests-to-predict-winners.html#cb169-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_true_shooting_percentage =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(true_shooting_percentage, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb169-16"><a href="using-random-forests-to-predict-winners.html#cb169-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_turnover_percentage =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(turnover_pct, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb169-17"><a href="using-random-forests-to-predict-winners.html#cb169-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_free_throw_factor =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(free_throw_factor, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),    </span>
<span id="cb169-18"><a href="using-random-forests-to-predict-winners.html#cb169-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb169-19"><a href="using-random-forests-to-predict-winners.html#cb169-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-20"><a href="using-random-forests-to-predict-winners.html#cb169-20" aria-hidden="true" tabindex="-1"></a>opponent <span class="ot">&lt;-</span> teamstats <span class="sc">%&gt;%</span> <span class="fu">select</span>(game_id, team_id, offensive_rebounds, defensive_rebounds) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">opponent_id=</span>team_id, <span class="at">opponent_offensive_rebounds =</span> offensive_rebounds, <span class="at">opponent_defensive_rebounds=</span>defensive_rebounds) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">opponent_id =</span> <span class="fu">as.numeric</span>(opponent_id))</span>
<span id="cb169-21"><a href="using-random-forests-to-predict-winners.html#cb169-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-22"><a href="using-random-forests-to-predict-winners.html#cb169-22" aria-hidden="true" tabindex="-1"></a>newteamstats <span class="ot">&lt;-</span> teamstats <span class="sc">%&gt;%</span> </span>
<span id="cb169-23"><a href="using-random-forests-to-predict-winners.html#cb169-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(opponent) <span class="sc">%&gt;%</span> </span>
<span id="cb169-24"><a href="using-random-forests-to-predict-winners.html#cb169-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb169-25"><a href="using-random-forests-to-predict-winners.html#cb169-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">orb =</span> offensive_rebounds <span class="sc">/</span> (offensive_rebounds <span class="sc">+</span> opponent_defensive_rebounds),</span>
<span id="cb169-26"><a href="using-random-forests-to-predict-winners.html#cb169-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">drb =</span> defensive_rebounds <span class="sc">/</span> (opponent_offensive_rebounds <span class="sc">+</span> defensive_rebounds),</span>
<span id="cb169-27"><a href="using-random-forests-to-predict-winners.html#cb169-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_orb =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(orb, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb169-28"><a href="using-random-forests-to-predict-winners.html#cb169-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_drb =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(drb, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>)</span>
<span id="cb169-29"><a href="using-random-forests-to-predict-winners.html#cb169-29" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;opponent_id&quot;, &quot;game_id&quot;)</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="using-random-forests-to-predict-winners.html#cb171-1" aria-hidden="true" tabindex="-1"></a>team_side <span class="ot">&lt;-</span> newteamstats <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="using-random-forests-to-predict-winners.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(game_id, team_id, team_short_display_name, opponent_id, game_date, season, team_score, team_rolling_true_shooting_percentage, team_rolling_free_throw_factor, team_rolling_turnover_percentage, team_rolling_orb, team_rolling_drb) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb171-3"><a href="using-random-forests-to-predict-winners.html#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="using-random-forests-to-predict-winners.html#cb171-4" aria-hidden="true" tabindex="-1"></a>opponent_side <span class="ot">&lt;-</span> newteamstats <span class="sc">%&gt;%</span></span>
<span id="cb171-5"><a href="using-random-forests-to-predict-winners.html#cb171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(game_id, team_id, team_short_display_name, team_score, team_rolling_true_shooting_percentage, team_rolling_free_throw_factor, team_rolling_turnover_percentage, team_rolling_orb, team_rolling_drb) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb171-6"><a href="using-random-forests-to-predict-winners.html#cb171-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb171-7"><a href="using-random-forests-to-predict-winners.html#cb171-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_id =</span> team_id,</span>
<span id="cb171-8"><a href="using-random-forests-to-predict-winners.html#cb171-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_short_display_name =</span> team_short_display_name,</span>
<span id="cb171-9"><a href="using-random-forests-to-predict-winners.html#cb171-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_score =</span> team_score,</span>
<span id="cb171-10"><a href="using-random-forests-to-predict-winners.html#cb171-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_true_shooting_percentage =</span> team_rolling_true_shooting_percentage,</span>
<span id="cb171-11"><a href="using-random-forests-to-predict-winners.html#cb171-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_free_throw_factor =</span> team_rolling_free_throw_factor,</span>
<span id="cb171-12"><a href="using-random-forests-to-predict-winners.html#cb171-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_turnover_percentage =</span> team_rolling_turnover_percentage,</span>
<span id="cb171-13"><a href="using-random-forests-to-predict-winners.html#cb171-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_orb =</span> team_rolling_orb,</span>
<span id="cb171-14"><a href="using-random-forests-to-predict-winners.html#cb171-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_drb =</span> team_rolling_drb</span>
<span id="cb171-15"><a href="using-random-forests-to-predict-winners.html#cb171-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb171-16"><a href="using-random-forests-to-predict-winners.html#cb171-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">opponent_id =</span> <span class="fu">as.numeric</span>(opponent_id))</span>
<span id="cb171-17"><a href="using-random-forests-to-predict-winners.html#cb171-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-18"><a href="using-random-forests-to-predict-winners.html#cb171-18" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> team_side <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(opponent_side) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb171-19"><a href="using-random-forests-to-predict-winners.html#cb171-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">TeamResult =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb171-20"><a href="using-random-forests-to-predict-winners.html#cb171-20" aria-hidden="true" tabindex="-1"></a>    team_score <span class="sc">&gt;</span> opponent_score <span class="sc">~</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb171-21"><a href="using-random-forests-to-predict-winners.html#cb171-21" aria-hidden="true" tabindex="-1"></a>    opponent_score <span class="sc">&gt;</span> team_score <span class="sc">~</span> <span class="st">&quot;L&quot;</span></span>
<span id="cb171-22"><a href="using-random-forests-to-predict-winners.html#cb171-22" aria-hidden="true" tabindex="-1"></a>))) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;game_id&quot;, &quot;opponent_id&quot;)</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="using-random-forests-to-predict-winners.html#cb173-1" aria-hidden="true" tabindex="-1"></a>games<span class="sc">$</span>TeamResult <span class="ot">&lt;-</span> <span class="fu">relevel</span>(games<span class="sc">$</span>TeamResult, <span class="at">ref=</span><span class="st">&quot;W&quot;</span>)</span>
<span id="cb173-2"><a href="using-random-forests-to-predict-winners.html#cb173-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-3"><a href="using-random-forests-to-predict-winners.html#cb173-3" aria-hidden="true" tabindex="-1"></a>modelgames <span class="ot">&lt;-</span> games <span class="sc">%&gt;%</span> <span class="fu">select</span>(game_id, game_date, team_short_display_name, opponent_short_display_name, season, team_rolling_true_shooting_percentage, opponent_rolling_true_shooting_percentage, team_rolling_turnover_percentage, opponent_rolling_turnover_percentage, TeamResult) </span></code></pre></div>
<p>With modelgames now with TeamResult and it being releveled, we’re ready to start the process.</p>
<div id="setup" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Setup</h2>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="using-random-forests-to-predict-winners.html#cb174-1" aria-hidden="true" tabindex="-1"></a>game_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(modelgames, <span class="at">prop =</span> .<span class="dv">8</span>)</span>
<span id="cb174-2"><a href="using-random-forests-to-predict-winners.html#cb174-2" aria-hidden="true" tabindex="-1"></a>game_train <span class="ot">&lt;-</span> <span class="fu">training</span>(game_split)</span>
<span id="cb174-3"><a href="using-random-forests-to-predict-winners.html#cb174-3" aria-hidden="true" tabindex="-1"></a>game_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(game_split)</span></code></pre></div>
<p>For this walkthrough, we’re going to do both a logistic regression and a random forest side by side to show the value of workflows.</p>
<p>The recipe we’ll create is the same for both, so we’ll use it twice.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="using-random-forests-to-predict-winners.html#cb175-1" aria-hidden="true" tabindex="-1"></a>game_recipe <span class="ot">&lt;-</span> </span>
<span id="cb175-2"><a href="using-random-forests-to-predict-winners.html#cb175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(TeamResult <span class="sc">~</span> ., <span class="at">data =</span> game_train) <span class="sc">%&gt;%</span> </span>
<span id="cb175-3"><a href="using-random-forests-to-predict-winners.html#cb175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(game_id, game_date, team_short_display_name, opponent_short_display_name, season, <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb175-4"><a href="using-random-forests-to-predict-winners.html#cb175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb175-5"><a href="using-random-forests-to-predict-winners.html#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="using-random-forests-to-predict-winners.html#cb175-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(game_recipe)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 4
##    variable                                  type    role      source  
##    &lt;chr&gt;                                     &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
##  1 game_id                                   numeric ID        original
##  2 game_date                                 date    ID        original
##  3 team_short_display_name                   nominal ID        original
##  4 opponent_short_display_name               nominal ID        original
##  5 season                                    numeric ID        original
##  6 team_rolling_true_shooting_percentage     numeric predictor original
##  7 opponent_rolling_true_shooting_percentage numeric predictor original
##  8 team_rolling_turnover_percentage          numeric predictor original
##  9 opponent_rolling_turnover_percentage      numeric predictor original
## 10 TeamResult                                nominal outcome   original</code></pre>
<p>Now, we’re going to create two different model specifications. The first will be the logistic regression model definintion and the second will be the random forest.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="using-random-forests-to-predict-winners.html#cb177-1" aria-hidden="true" tabindex="-1"></a>log_mod <span class="ot">&lt;-</span> </span>
<span id="cb177-2"><a href="using-random-forests-to-predict-winners.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="using-random-forests-to-predict-winners.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;glm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb177-4"><a href="using-random-forests-to-predict-winners.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="using-random-forests-to-predict-winners.html#cb178-1" aria-hidden="true" tabindex="-1"></a>rf_mod <span class="ot">&lt;-</span> </span>
<span id="cb178-2"><a href="using-random-forests-to-predict-winners.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb178-3"><a href="using-random-forests-to-predict-winners.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;ranger&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb178-4"><a href="using-random-forests-to-predict-winners.html#cb178-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>)</span></code></pre></div>
<p>Now we have enough for our workflows. We have two models and one recipe.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="using-random-forests-to-predict-winners.html#cb179-1" aria-hidden="true" tabindex="-1"></a>log_workflow <span class="ot">&lt;-</span> </span>
<span id="cb179-2"><a href="using-random-forests-to-predict-winners.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb179-3"><a href="using-random-forests-to-predict-winners.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(log_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb179-4"><a href="using-random-forests-to-predict-winners.html#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(game_recipe)</span></code></pre></div>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="using-random-forests-to-predict-winners.html#cb180-1" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span> </span>
<span id="cb180-2"><a href="using-random-forests-to-predict-winners.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb180-3"><a href="using-random-forests-to-predict-winners.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb180-4"><a href="using-random-forests-to-predict-winners.html#cb180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(game_recipe)</span></code></pre></div>
<p>Now we can fit our models to the data.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="using-random-forests-to-predict-winners.html#cb181-1" aria-hidden="true" tabindex="-1"></a>log_fit <span class="ot">&lt;-</span> </span>
<span id="cb181-2"><a href="using-random-forests-to-predict-winners.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  log_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb181-3"><a href="using-random-forests-to-predict-winners.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> game_train)</span></code></pre></div>
<p>The random forest fit is going to take a beat or two.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="using-random-forests-to-predict-winners.html#cb182-1" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="ot">&lt;-</span> </span>
<span id="cb182-2"><a href="using-random-forests-to-predict-winners.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  rf_workflow <span class="sc">%&gt;%</span> </span>
<span id="cb182-3"><a href="using-random-forests-to-predict-winners.html#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> game_train)</span></code></pre></div>
<p>Now we can bind our predictions to the training data and see how we did.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="using-random-forests-to-predict-winners.html#cb183-1" aria-hidden="true" tabindex="-1"></a>logpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_train) <span class="sc">%&gt;%</span></span>
<span id="cb183-2"><a href="using-random-forests-to-predict-winners.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(game_train) </span>
<span id="cb183-3"><a href="using-random-forests-to-predict-winners.html#cb183-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-4"><a href="using-random-forests-to-predict-winners.html#cb183-4" aria-hidden="true" tabindex="-1"></a>logpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_train, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb183-5"><a href="using-random-forests-to-predict-winners.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(logpredict)</span></code></pre></div>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="using-random-forests-to-predict-winners.html#cb184-1" aria-hidden="true" tabindex="-1"></a>rfpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_train) <span class="sc">%&gt;%</span></span>
<span id="cb184-2"><a href="using-random-forests-to-predict-winners.html#cb184-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(game_train) </span>
<span id="cb184-3"><a href="using-random-forests-to-predict-winners.html#cb184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-4"><a href="using-random-forests-to-predict-winners.html#cb184-4" aria-hidden="true" tabindex="-1"></a>rfpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_train, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb184-5"><a href="using-random-forests-to-predict-winners.html#cb184-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(rfpredict)</span></code></pre></div>
<p>Now, how did we do? First, let’s look at the logistic regression.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="using-random-forests-to-predict-winners.html#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(logpredict, TeamResult, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.624
## 2 kap      binary         0.248</code></pre>
<p>Same as last time, the logistic regression model comes in at 62 percent accuracy, and when we expose it to testing data, it remains pretty stable. <em>This is a gigantic hint about what is to come.</em></p>
<p>How about the random forest?</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="using-random-forests-to-predict-winners.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(rfpredict, TeamResult, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.994
## 2 kap      binary         0.989</code></pre>
<p>Holy buckets! We made a model that’s 99 percent accurate? GET ME TO VEGAS.</p>
<p>Remember: Where a model makes its money is in data that it has never seen before.</p>
<p>First, we look at logistic regression.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="using-random-forests-to-predict-winners.html#cb189-1" aria-hidden="true" tabindex="-1"></a>logtestpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_test) <span class="sc">%&gt;%</span></span>
<span id="cb189-2"><a href="using-random-forests-to-predict-winners.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(game_test)</span>
<span id="cb189-3"><a href="using-random-forests-to-predict-winners.html#cb189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-4"><a href="using-random-forests-to-predict-winners.html#cb189-4" aria-hidden="true" tabindex="-1"></a>logtestpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_test, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb189-5"><a href="using-random-forests-to-predict-winners.html#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(logtestpredict)</span>
<span id="cb189-6"><a href="using-random-forests-to-predict-winners.html#cb189-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-7"><a href="using-random-forests-to-predict-winners.html#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(logtestpredict, TeamResult, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.622
## 2 kap      binary         0.244</code></pre>
<p>Just about the same. That’s a robust model.</p>
<p>Now, the inevitable crash with random forests.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="using-random-forests-to-predict-winners.html#cb191-1" aria-hidden="true" tabindex="-1"></a>rftestpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_test) <span class="sc">%&gt;%</span></span>
<span id="cb191-2"><a href="using-random-forests-to-predict-winners.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(game_test)</span>
<span id="cb191-3"><a href="using-random-forests-to-predict-winners.html#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="using-random-forests-to-predict-winners.html#cb191-4" aria-hidden="true" tabindex="-1"></a>rftestpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> game_test, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb191-5"><a href="using-random-forests-to-predict-winners.html#cb191-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(rftestpredict)</span>
<span id="cb191-6"><a href="using-random-forests-to-predict-winners.html#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="using-random-forests-to-predict-winners.html#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(rftestpredict, TeamResult, .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.596
## 2 kap      binary         0.192</code></pre>
<p>Right at 59 percent. A little bit lower than logistic regression. But did they come to the same answers to get those numbers? No.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="using-random-forests-to-predict-winners.html#cb193-1" aria-hidden="true" tabindex="-1"></a>logtestpredict <span class="sc">%&gt;%</span></span>
<span id="cb193-2"><a href="using-random-forests-to-predict-winners.html#cb193-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(TeamResult, .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction    W    L
##          W 3472 2022
##          L 2135 3373</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="using-random-forests-to-predict-winners.html#cb195-1" aria-hidden="true" tabindex="-1"></a>rftestpredict <span class="sc">%&gt;%</span></span>
<span id="cb195-2"><a href="using-random-forests-to-predict-winners.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(TeamResult, .pred_class)</span></code></pre></div>
<pre><code>##           Truth
## Prediction    W    L
##          W 3383 2221
##          L 2224 3174</code></pre>
<p>Our two models, based on our feature engineering, are only slightly better than flipping a coin. But while that doesn’t sound great, some circumstances make it look uncanny.</p>
<p>Let’s use our fits to see what’s happened in Nebraska’s season so far, to see differences in the models.</p>
<p>Here’s the logistic regression.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="using-random-forests-to-predict-winners.html#cb197-1" aria-hidden="true" tabindex="-1"></a>nu <span class="ot">&lt;-</span> modelgames <span class="sc">%&gt;%</span> <span class="fu">filter</span>(team_short_display_name <span class="sc">==</span> <span class="st">&quot;Nebraska&quot;</span> <span class="sc">&amp;</span> season <span class="sc">==</span> <span class="dv">2022</span>) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(game_date)</span>
<span id="cb197-2"><a href="using-random-forests-to-predict-winners.html#cb197-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-3"><a href="using-random-forests-to-predict-winners.html#cb197-3" aria-hidden="true" tabindex="-1"></a>nulogpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> nu) <span class="sc">%&gt;%</span></span>
<span id="cb197-4"><a href="using-random-forests-to-predict-winners.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nu)</span>
<span id="cb197-5"><a href="using-random-forests-to-predict-winners.html#cb197-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-6"><a href="using-random-forests-to-predict-winners.html#cb197-6" aria-hidden="true" tabindex="-1"></a>nulogpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> nu, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb197-7"><a href="using-random-forests-to-predict-winners.html#cb197-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nulogpredict)</span>
<span id="cb197-8"><a href="using-random-forests-to-predict-winners.html#cb197-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-9"><a href="using-random-forests-to-predict-winners.html#cb197-9" aria-hidden="true" tabindex="-1"></a>nulogpredict <span class="sc">%&gt;%</span> <span class="fu">select</span>(.pred_class, TeamResult, opponent_short_display_name, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 17 × 13
##    .pred_class TeamResult opponent_short_dis… .pred_W .pred_L game_id game_date 
##    &lt;fct&gt;       &lt;fct&gt;      &lt;chr&gt;                 &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;date&gt;    
##  1 L           W          Kennesaw State        0.431   0.569  4.01e8 2021-12-23
##  2 L           L          Ohio State            0.339   0.661  4.01e8 2022-01-03
##  3 L           L          Michigan State        0.432   0.568  4.01e8 2022-01-06
##  4 L           L          Rutgers               0.429   0.571  4.01e8 2022-01-08
##  5 L           L          Illinois              0.197   0.803  4.01e8 2022-01-12
##  6 L           L          Purdue                0.200   0.800  4.01e8 2022-01-14
##  7 L           L          Indiana               0.362   0.638  4.01e8 2022-01-17
##  8 L           L          Wisconsin             0.282   0.718  4.01e8 2022-01-27
##  9 L           L          Rutgers               0.454   0.546  4.01e8 2022-01-29
## 10 L           L          Michigan              0.289   0.711  4.01e8 2022-02-02
## 11 L           L          Northwestern          0.470   0.530  4.01e8 2022-02-05
## 12 L           W          Minnesota             0.356   0.644  4.01e8 2022-02-10
## 13 L           L          Iowa                  0.309   0.691  4.01e8 2022-02-13
## 14 L           L          Maryland              0.441   0.559  4.01e8 2022-02-19
## 15 L           L          Northwestern          0.468   0.532  4.01e8 2022-02-23
## 16 L           L          Iowa                  0.312   0.688  4.01e8 2022-02-26
## 17 W           W          Penn State            0.560   0.440  4.01e8 2022-02-28
## # … with 6 more variables: team_short_display_name &lt;chr&gt;, season &lt;int&gt;,
## #   team_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   opponent_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   team_rolling_turnover_percentage &lt;dbl&gt;,
## #   opponent_rolling_turnover_percentage &lt;dbl&gt;</code></pre>
<p>It gets the Kennesaw State game wrong – the 11th game of the season – and thought we’d lose to Minnesota. Those are the two misses.</p>
<p>Now, the random forest.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="using-random-forests-to-predict-winners.html#cb199-1" aria-hidden="true" tabindex="-1"></a>nurfpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> nu) <span class="sc">%&gt;%</span></span>
<span id="cb199-2"><a href="using-random-forests-to-predict-winners.html#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nu)</span>
<span id="cb199-3"><a href="using-random-forests-to-predict-winners.html#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="using-random-forests-to-predict-winners.html#cb199-4" aria-hidden="true" tabindex="-1"></a>nurfpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> nu, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb199-5"><a href="using-random-forests-to-predict-winners.html#cb199-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nurfpredict)</span>
<span id="cb199-6"><a href="using-random-forests-to-predict-winners.html#cb199-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-7"><a href="using-random-forests-to-predict-winners.html#cb199-7" aria-hidden="true" tabindex="-1"></a>nurfpredict <span class="sc">%&gt;%</span> <span class="fu">select</span>(.pred_class, TeamResult, opponent_short_display_name, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## # A tibble: 17 × 13
##    .pred_class TeamResult opponent_short_dis… .pred_W .pred_L game_id game_date 
##    &lt;fct&gt;       &lt;fct&gt;      &lt;chr&gt;                 &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;date&gt;    
##  1 W           W          Kennesaw State        0.734   0.266  4.01e8 2021-12-23
##  2 W           L          Ohio State            0.538   0.462  4.01e8 2022-01-03
##  3 L           L          Michigan State        0.191   0.809  4.01e8 2022-01-06
##  4 L           L          Rutgers               0.239   0.761  4.01e8 2022-01-08
##  5 L           L          Illinois              0.218   0.782  4.01e8 2022-01-12
##  6 L           L          Purdue                0.304   0.696  4.01e8 2022-01-14
##  7 L           L          Indiana               0.129   0.871  4.01e8 2022-01-17
##  8 L           L          Wisconsin             0.166   0.834  4.01e8 2022-01-27
##  9 L           L          Rutgers               0.143   0.857  4.01e8 2022-01-29
## 10 L           L          Michigan              0.153   0.847  4.01e8 2022-02-02
## 11 W           L          Northwestern          0.568   0.432  4.01e8 2022-02-05
## 12 W           W          Minnesota             0.679   0.321  4.01e8 2022-02-10
## 13 L           L          Iowa                  0.114   0.886  4.01e8 2022-02-13
## 14 L           L          Maryland              0.193   0.807  4.01e8 2022-02-19
## 15 L           L          Northwestern          0.398   0.602  4.01e8 2022-02-23
## 16 L           L          Iowa                  0.242   0.758  4.01e8 2022-02-26
## 17 W           W          Penn State            0.788   0.212  4.01e8 2022-02-28
## # … with 6 more variables: team_short_display_name &lt;chr&gt;, season &lt;int&gt;,
## #   team_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   opponent_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   team_rolling_turnover_percentage &lt;dbl&gt;,
## #   opponent_rolling_turnover_percentage &lt;dbl&gt;</code></pre>
<p>Flawless. But is it? No. More luck than perfection. More Nebraska being worse than the teams they were playing, so not a lot of close calls.</p>
</div>
<div id="predicting-a-future-game" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Predicting a future game</h2>
<p>This is being written on Monday, Feb. 21 and Nebraska plays Northwestern on Tuesday the 22nd. What do these models have to say about that game?</p>
<p>We can get what we need by reworking what we do above and removing the lag. We use the lag to simulate knowing the stats before the game – not after. So by removing it, we return to our state of not knowing, since this game hasn’t been played yet.</p>
<p>We can create a tibble – a dataframe – that matches our modelgames data that our two fits are expecting. It looks like this.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="using-random-forests-to-predict-winners.html#cb201-1" aria-hidden="true" tabindex="-1"></a>win_prediction <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb201-2"><a href="using-random-forests-to-predict-winners.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">game_id =</span> <span class="dv">1</span>,</span>
<span id="cb201-3"><a href="using-random-forests-to-predict-winners.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">game_date =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2022-02-21&quot;</span>),</span>
<span id="cb201-4"><a href="using-random-forests-to-predict-winners.html#cb201-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">team_short_display_name=</span><span class="st">&quot;Nebraska&quot;</span>,</span>
<span id="cb201-5"><a href="using-random-forests-to-predict-winners.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">opponent_short_display_name=</span><span class="st">&quot;Northwestern&quot;</span>,</span>
<span id="cb201-6"><a href="using-random-forests-to-predict-winners.html#cb201-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">season =</span> <span class="dv">2022</span>,</span>
<span id="cb201-7"><a href="using-random-forests-to-predict-winners.html#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">team_rolling_true_shooting_percentage =</span> <span class="fl">53.73109</span>, </span>
<span id="cb201-8"><a href="using-random-forests-to-predict-winners.html#cb201-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">opponent_rolling_true_shooting_percentage =</span> <span class="fl">51.20706</span>, </span>
<span id="cb201-9"><a href="using-random-forests-to-predict-winners.html#cb201-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">team_rolling_turnover_percentage =</span> <span class="fl">0.1690204</span>,</span>
<span id="cb201-10"><a href="using-random-forests-to-predict-winners.html#cb201-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">opponent_rolling_turnover_percentage =</span> <span class="fl">0.1345149</span></span>
<span id="cb201-11"><a href="using-random-forests-to-predict-winners.html#cb201-11" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>First we’ll try the logistic regression.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="using-random-forests-to-predict-winners.html#cb202-1" aria-hidden="true" tabindex="-1"></a>nulogpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> win_prediction) <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="using-random-forests-to-predict-winners.html#cb202-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(win_prediction)</span>
<span id="cb202-3"><a href="using-random-forests-to-predict-winners.html#cb202-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-4"><a href="using-random-forests-to-predict-winners.html#cb202-4" aria-hidden="true" tabindex="-1"></a>nulogpredict <span class="ot">&lt;-</span> log_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> nulogpredict, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb202-5"><a href="using-random-forests-to-predict-winners.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nulogpredict)</span>
<span id="cb202-6"><a href="using-random-forests-to-predict-winners.html#cb202-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-7"><a href="using-random-forests-to-predict-winners.html#cb202-7" aria-hidden="true" tabindex="-1"></a>nulogpredict</span></code></pre></div>
<pre><code>## # A tibble: 1 × 12
##   .pred_W .pred_L .pred_class game_id game_date  team_short_display_name
##     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;                  
## 1   0.468   0.532 L                 1 2022-02-21 Nebraska               
## # … with 6 more variables: opponent_short_display_name &lt;chr&gt;, season &lt;dbl&gt;,
## #   team_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   opponent_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   team_rolling_turnover_percentage &lt;dbl&gt;,
## #   opponent_rolling_turnover_percentage &lt;dbl&gt;</code></pre>
<p>Logistic regression gives Nebraska a 47 percent chance of winning against Northwestern. Now, random forest.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="using-random-forests-to-predict-winners.html#cb204-1" aria-hidden="true" tabindex="-1"></a>nurfpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> win_prediction) <span class="sc">%&gt;%</span></span>
<span id="cb204-2"><a href="using-random-forests-to-predict-winners.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(win_prediction)</span>
<span id="cb204-3"><a href="using-random-forests-to-predict-winners.html#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="using-random-forests-to-predict-winners.html#cb204-4" aria-hidden="true" tabindex="-1"></a>nurfpredict <span class="ot">&lt;-</span> rf_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> nurfpredict, <span class="at">type=</span><span class="st">&quot;prob&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb204-5"><a href="using-random-forests-to-predict-winners.html#cb204-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nurfpredict)</span>
<span id="cb204-6"><a href="using-random-forests-to-predict-winners.html#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="using-random-forests-to-predict-winners.html#cb204-7" aria-hidden="true" tabindex="-1"></a>nurfpredict</span></code></pre></div>
<pre><code>## # A tibble: 1 × 12
##   .pred_W .pred_L .pred_class game_id game_date  team_short_display_name
##     &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;         &lt;dbl&gt; &lt;date&gt;     &lt;chr&gt;                  
## 1   0.398   0.602 L                 1 2022-02-21 Nebraska               
## # … with 6 more variables: opponent_short_display_name &lt;chr&gt;, season &lt;dbl&gt;,
## #   team_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   opponent_rolling_true_shooting_percentage &lt;dbl&gt;,
## #   team_rolling_turnover_percentage &lt;dbl&gt;,
## #   opponent_rolling_turnover_percentage &lt;dbl&gt;</code></pre>
<p>Random forest is even less bullish on Nebraksa’s chances. It gives the Huskers an 38 percent chance.</p>
<p>Spoiler Alert: They lost.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="logistic-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="xgboost-to-make-classifications.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/06-randomforestspart2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["advancedsportsdataanalysis.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
