<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 XGBoost to make classifications | Advanced Sports Data Analysis</title>
  <meta name="description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 XGBoost to make classifications | Advanced Sports Data Analysis" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 XGBoost to make classifications | Advanced Sports Data Analysis" />
  
  <meta name="twitter:description" content="This is the companion text to the University of Nebraska-Lincoln’s SPMC 460: Advanced Sports Data Analysis" />
  

<meta name="author" content="By Matt Waite" />


<meta name="date" content="2022-02-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="using-random-forests-to-predict-winners.html"/>
<link rel="next" href="support-vector-machines.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Sports Data Analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements-and-conventions"><i class="fa fa-check"></i><b>1.1</b> Requirements and Conventions</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-this-book"><i class="fa fa-check"></i><b>1.2</b> About this book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html"><i class="fa fa-check"></i><b>2</b> The modeling process and linear regression</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#feature-engineering"><i class="fa fa-check"></i><b>2.1</b> Feature engineering</a></li>
<li class="chapter" data-level="2.2" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#setting-up-the-modeling-process"><i class="fa fa-check"></i><b>2.2</b> Setting up the modeling process</a></li>
<li class="chapter" data-level="2.3" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#predicting-based-on-the-model"><i class="fa fa-check"></i><b>2.3</b> Predicting based on the model</a></li>
<li class="chapter" data-level="2.4" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#predicting-data-we-havent-seen-before"><i class="fa fa-check"></i><b>2.4</b> Predicting data we haven’t seen before</a></li>
<li class="chapter" data-level="2.5" data-path="the-modeling-process-and-linear-regression.html"><a href="the-modeling-process-and-linear-regression.html#looking-locally"><i class="fa fa-check"></i><b>2.5</b> Looking locally</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="multiple-regression.html"><a href="multiple-regression.html"><i class="fa fa-check"></i><b>3</b> Multiple regression</a>
<ul>
<li class="chapter" data-level="3.1" data-path="multiple-regression.html"><a href="multiple-regression.html#a-multiple-regression-speed-run"><i class="fa fa-check"></i><b>3.1</b> A multiple regression speed run</a></li>
<li class="chapter" data-level="3.2" data-path="multiple-regression.html"><a href="multiple-regression.html#picking-what-moves-the-needle"><i class="fa fa-check"></i><b>3.2</b> Picking what moves the needle</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html"><i class="fa fa-check"></i><b>4</b> Decision trees and random forests</a>
<ul>
<li class="chapter" data-level="4.1" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#an-intro-to-pre-processing"><i class="fa fa-check"></i><b>4.1</b> An intro to pre-processing</a></li>
<li class="chapter" data-level="4.2" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#decision-trees"><i class="fa fa-check"></i><b>4.2</b> Decision trees</a></li>
<li class="chapter" data-level="4.3" data-path="decision-trees-and-random-forests.html"><a href="decision-trees-and-random-forests.html#random-forest"><i class="fa fa-check"></i><b>4.3</b> Random forest</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="xgboost.html"><a href="xgboost.html"><i class="fa fa-check"></i><b>5</b> XGBoost</a>
<ul>
<li class="chapter" data-level="5.1" data-path="xgboost.html"><a href="xgboost.html#hyperparameters"><i class="fa fa-check"></i><b>5.1</b> Hyperparameters</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>6</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="logistic-regression.html"><a href="logistic-regression.html#visualizing-the-decision-boundary"><i class="fa fa-check"></i><b>6.1</b> Visualizing the decision boundary</a></li>
<li class="chapter" data-level="6.2" data-path="logistic-regression.html"><a href="logistic-regression.html#the-logistic-regression"><i class="fa fa-check"></i><b>6.2</b> The logistic regression</a></li>
<li class="chapter" data-level="6.3" data-path="logistic-regression.html"><a href="logistic-regression.html#evaluating-the-fit"><i class="fa fa-check"></i><b>6.3</b> Evaluating the fit</a></li>
<li class="chapter" data-level="6.4" data-path="logistic-regression.html"><a href="logistic-regression.html#comparing-it-to-test-data"><i class="fa fa-check"></i><b>6.4</b> Comparing it to test data</a></li>
<li class="chapter" data-level="6.5" data-path="logistic-regression.html"><a href="logistic-regression.html#how-well-did-it-do-with-nebraska"><i class="fa fa-check"></i><b>6.5</b> How well did it do with Nebraska?</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="using-random-forests-to-predict-winners.html"><a href="using-random-forests-to-predict-winners.html"><i class="fa fa-check"></i><b>7</b> Using random forests to predict winners</a>
<ul>
<li class="chapter" data-level="7.1" data-path="using-random-forests-to-predict-winners.html"><a href="using-random-forests-to-predict-winners.html#setup"><i class="fa fa-check"></i><b>7.1</b> Setup</a></li>
<li class="chapter" data-level="7.2" data-path="using-random-forests-to-predict-winners.html"><a href="using-random-forests-to-predict-winners.html#predicting-a-future-game"><i class="fa fa-check"></i><b>7.2</b> Predicting a future game</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="xgboost-to-make-classifications.html"><a href="xgboost-to-make-classifications.html"><i class="fa fa-check"></i><b>8</b> XGBoost to make classifications</a></li>
<li class="chapter" data-level="9" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>9</b> Support Vector Machines</a>
<ul>
<li class="chapter" data-level="9.1" data-path="support-vector-machines.html"><a href="support-vector-machines.html#logistic-regression-1"><i class="fa fa-check"></i><b>9.1</b> Logistic regression</a></li>
<li class="chapter" data-level="9.2" data-path="support-vector-machines.html"><a href="support-vector-machines.html#random-forest-1"><i class="fa fa-check"></i><b>9.2</b> Random forest</a></li>
<li class="chapter" data-level="9.3" data-path="support-vector-machines.html"><a href="support-vector-machines.html#support-vector-machine"><i class="fa fa-check"></i><b>9.3</b> Support Vector Machine</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Sports Data Analysis</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="xgboost-to-make-classifications" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> XGBoost to make classifications</h1>
<p>And now we return to XGBoost, but now for classifications. Recall that boosting methods are another wrinkle in the tree based methods. Instead of deep trees, boosting methods intentionally pick shallow trees – called stumps – that, at least initially, do a poor job of predicting the outcome. Then, each subsequent stump takes the job the previous one did, optimizes to reduce the residuals – the gap between prediction and reality – and makes a prediction. And then the next one does the same, and so on and so on.</p>
<p>So far, our logistic regression and random forest methods are just better than coin flipping (which would be 50 percent accurate). Does XGBoost, with it’s method of optimizing for reduced error, fare any better? Let’s try, and we’ll add in a little wrinkle – assigning a dummy value to home or away. The home team gets 1, the away team gets 0. The truth is XGboost is going to be similarly predictive. Let’s see what we can do with an additional value.</p>
<p>We’ll restore our libraries and feature engineering, now with a dummy value for home_away.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="xgboost-to-make-classifications.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb206-2"><a href="xgboost-to-make-classifications.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb206-3"><a href="xgboost-to-make-classifications.html#cb206-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb206-4"><a href="xgboost-to-make-classifications.html#cb206-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hoopR)</span>
<span id="cb206-5"><a href="xgboost-to-make-classifications.html#cb206-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-6"><a href="xgboost-to-make-classifications.html#cb206-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb206-7"><a href="xgboost-to-make-classifications.html#cb206-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-8"><a href="xgboost-to-make-classifications.html#cb206-8" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(doParallel)</span>
<span id="cb206-9"><a href="xgboost-to-make-classifications.html#cb206-9" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>(<span class="at">logical =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="xgboost-to-make-classifications.html#cb207-1" aria-hidden="true" tabindex="-1"></a>teamgames <span class="ot">&lt;-</span> <span class="fu">load_mbb_team_box</span>(<span class="at">seasons =</span> <span class="dv">2015</span><span class="sc">:</span><span class="dv">2022</span>) <span class="sc">%&gt;%</span></span>
<span id="cb207-2"><a href="xgboost-to-make-classifications.html#cb207-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(field_goals_made_field_goals_attempted, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;field_goals_made&quot;</span>,<span class="st">&quot;field_goals_attempted&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb207-3"><a href="xgboost-to-make-classifications.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(three_point_field_goals_made_three_point_field_goals_attempted, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;three_point_field_goals_made&quot;</span>,<span class="st">&quot;three_point_field_goals_attempted&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb207-4"><a href="xgboost-to-make-classifications.html#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(free_throws_made_free_throws_attempted, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;free_throws_made&quot;</span>,<span class="st">&quot;free_throws_attempted&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb207-5"><a href="xgboost-to-make-classifications.html#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="dv">12</span><span class="sc">:</span><span class="dv">34</span>, as.numeric)</span>
<span id="cb207-6"><a href="xgboost-to-make-classifications.html#cb207-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-7"><a href="xgboost-to-make-classifications.html#cb207-7" aria-hidden="true" tabindex="-1"></a>teamstats <span class="ot">&lt;-</span> teamgames <span class="sc">%&gt;%</span> </span>
<span id="cb207-8"><a href="xgboost-to-make-classifications.html#cb207-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(team_short_display_name, season) <span class="sc">%&gt;%</span></span>
<span id="cb207-9"><a href="xgboost-to-make-classifications.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(game_date) <span class="sc">%&gt;%</span></span>
<span id="cb207-10"><a href="xgboost-to-make-classifications.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb207-11"><a href="xgboost-to-make-classifications.html#cb207-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_score =</span> ((field_goals_made<span class="sc">-</span>three_point_field_goals_made) <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span> (three_point_field_goals_made<span class="sc">*</span><span class="dv">3</span>) <span class="sc">+</span> free_throws_made,</span>
<span id="cb207-12"><a href="xgboost-to-make-classifications.html#cb207-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_shooting_percentage =</span> (team_score <span class="sc">/</span> (<span class="dv">2</span><span class="sc">*</span>(field_goals_attempted <span class="sc">+</span> (.<span class="dv">44</span> <span class="sc">*</span> free_throws_attempted)))) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb207-13"><a href="xgboost-to-make-classifications.html#cb207-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">turnover_pct =</span> turnovers<span class="sc">/</span>(field_goals_attempted <span class="sc">+</span> <span class="fl">0.44</span> <span class="sc">*</span> free_throws_attempted <span class="sc">+</span> turnovers),</span>
<span id="cb207-14"><a href="xgboost-to-make-classifications.html#cb207-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">free_throw_factor =</span> free_throws_made<span class="sc">/</span>field_goals_attempted,</span>
<span id="cb207-15"><a href="xgboost-to-make-classifications.html#cb207-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_true_shooting_percentage =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(true_shooting_percentage, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb207-16"><a href="xgboost-to-make-classifications.html#cb207-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_turnover_percentage =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(turnover_pct, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb207-17"><a href="xgboost-to-make-classifications.html#cb207-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_free_throw_factor =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(free_throw_factor, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),    </span>
<span id="cb207-18"><a href="xgboost-to-make-classifications.html#cb207-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb207-19"><a href="xgboost-to-make-classifications.html#cb207-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-20"><a href="xgboost-to-make-classifications.html#cb207-20" aria-hidden="true" tabindex="-1"></a>opponent <span class="ot">&lt;-</span> teamstats <span class="sc">%&gt;%</span> <span class="fu">select</span>(game_id, team_id, offensive_rebounds, defensive_rebounds) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">opponent_id=</span>team_id, <span class="at">opponent_offensive_rebounds =</span> offensive_rebounds, <span class="at">opponent_defensive_rebounds=</span>defensive_rebounds) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">opponent_id =</span> <span class="fu">as.numeric</span>(opponent_id))</span>
<span id="cb207-21"><a href="xgboost-to-make-classifications.html#cb207-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-22"><a href="xgboost-to-make-classifications.html#cb207-22" aria-hidden="true" tabindex="-1"></a>newteamstats <span class="ot">&lt;-</span> teamstats <span class="sc">%&gt;%</span> </span>
<span id="cb207-23"><a href="xgboost-to-make-classifications.html#cb207-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(opponent) <span class="sc">%&gt;%</span> </span>
<span id="cb207-24"><a href="xgboost-to-make-classifications.html#cb207-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb207-25"><a href="xgboost-to-make-classifications.html#cb207-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">orb =</span> offensive_rebounds <span class="sc">/</span> (offensive_rebounds <span class="sc">+</span> opponent_defensive_rebounds),</span>
<span id="cb207-26"><a href="xgboost-to-make-classifications.html#cb207-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">drb =</span> defensive_rebounds <span class="sc">/</span> (opponent_offensive_rebounds <span class="sc">+</span> defensive_rebounds),</span>
<span id="cb207-27"><a href="xgboost-to-make-classifications.html#cb207-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_orb =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(orb, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb207-28"><a href="xgboost-to-make-classifications.html#cb207-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_rolling_drb =</span> <span class="fu">rollmean</span>(<span class="fu">lag</span>(drb, <span class="at">n=</span><span class="dv">1</span>), <span class="at">k=</span><span class="dv">10</span>, <span class="at">align=</span><span class="st">&quot;right&quot;</span>, <span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb207-29"><a href="xgboost-to-make-classifications.html#cb207-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">team_dummy_home_away =</span> <span class="fu">case_when</span>(</span>
<span id="cb207-30"><a href="xgboost-to-make-classifications.html#cb207-30" aria-hidden="true" tabindex="-1"></a>      home_away <span class="sc">==</span> <span class="st">&quot;HOME&quot;</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb207-31"><a href="xgboost-to-make-classifications.html#cb207-31" aria-hidden="true" tabindex="-1"></a>      home_away <span class="sc">==</span> <span class="st">&quot;AWAY&quot;</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb207-32"><a href="xgboost-to-make-classifications.html#cb207-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb207-33"><a href="xgboost-to-make-classifications.html#cb207-33" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;opponent_id&quot;, &quot;game_id&quot;)</code></pre>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="xgboost-to-make-classifications.html#cb209-1" aria-hidden="true" tabindex="-1"></a>team_side <span class="ot">&lt;-</span> newteamstats <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="xgboost-to-make-classifications.html#cb209-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(game_id, team_id, team_short_display_name, opponent_id, game_date, season, team_score, team_rolling_true_shooting_percentage, team_rolling_free_throw_factor, team_rolling_turnover_percentage, team_rolling_orb, team_rolling_drb, team_dummy_home_away) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span>
<span id="cb209-3"><a href="xgboost-to-make-classifications.html#cb209-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4"><a href="xgboost-to-make-classifications.html#cb209-4" aria-hidden="true" tabindex="-1"></a>opponent_side <span class="ot">&lt;-</span> newteamstats <span class="sc">%&gt;%</span></span>
<span id="cb209-5"><a href="xgboost-to-make-classifications.html#cb209-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(game_id, team_id, team_short_display_name, team_score, team_rolling_true_shooting_percentage, team_rolling_free_throw_factor, team_rolling_turnover_percentage, team_rolling_orb, team_rolling_drb) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb209-6"><a href="xgboost-to-make-classifications.html#cb209-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(</span>
<span id="cb209-7"><a href="xgboost-to-make-classifications.html#cb209-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_id =</span> team_id,</span>
<span id="cb209-8"><a href="xgboost-to-make-classifications.html#cb209-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_short_display_name =</span> team_short_display_name,</span>
<span id="cb209-9"><a href="xgboost-to-make-classifications.html#cb209-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_score =</span> team_score,</span>
<span id="cb209-10"><a href="xgboost-to-make-classifications.html#cb209-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_true_shooting_percentage =</span> team_rolling_true_shooting_percentage,</span>
<span id="cb209-11"><a href="xgboost-to-make-classifications.html#cb209-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_free_throw_factor =</span> team_rolling_free_throw_factor,</span>
<span id="cb209-12"><a href="xgboost-to-make-classifications.html#cb209-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_turnover_percentage =</span> team_rolling_turnover_percentage,</span>
<span id="cb209-13"><a href="xgboost-to-make-classifications.html#cb209-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_orb =</span> team_rolling_orb,</span>
<span id="cb209-14"><a href="xgboost-to-make-classifications.html#cb209-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">opponent_rolling_drb =</span> team_rolling_drb</span>
<span id="cb209-15"><a href="xgboost-to-make-classifications.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb209-16"><a href="xgboost-to-make-classifications.html#cb209-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">opponent_id =</span> <span class="fu">as.numeric</span>(opponent_id))</span>
<span id="cb209-17"><a href="xgboost-to-make-classifications.html#cb209-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-18"><a href="xgboost-to-make-classifications.html#cb209-18" aria-hidden="true" tabindex="-1"></a>games <span class="ot">&lt;-</span> team_side <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(opponent_side) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb209-19"><a href="xgboost-to-make-classifications.html#cb209-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">TeamResult =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(</span>
<span id="cb209-20"><a href="xgboost-to-make-classifications.html#cb209-20" aria-hidden="true" tabindex="-1"></a>    team_score <span class="sc">&gt;</span> opponent_score <span class="sc">~</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb209-21"><a href="xgboost-to-make-classifications.html#cb209-21" aria-hidden="true" tabindex="-1"></a>    opponent_score <span class="sc">&gt;</span> team_score <span class="sc">~</span> <span class="st">&quot;L&quot;</span></span>
<span id="cb209-22"><a href="xgboost-to-make-classifications.html#cb209-22" aria-hidden="true" tabindex="-1"></a>))) <span class="sc">%&gt;%</span> <span class="fu">na.omit</span>()</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;game_id&quot;, &quot;opponent_id&quot;)</code></pre>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="xgboost-to-make-classifications.html#cb211-1" aria-hidden="true" tabindex="-1"></a>games<span class="sc">$</span>TeamResult <span class="ot">&lt;-</span> <span class="fu">relevel</span>(games<span class="sc">$</span>TeamResult, <span class="at">ref=</span><span class="st">&quot;W&quot;</span>)</span>
<span id="cb211-2"><a href="xgboost-to-make-classifications.html#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="xgboost-to-make-classifications.html#cb211-3" aria-hidden="true" tabindex="-1"></a>modelgames <span class="ot">&lt;-</span> games <span class="sc">%&gt;%</span> <span class="fu">select</span>(game_id, game_date, team_short_display_name, opponent_short_display_name, season, team_rolling_true_shooting_percentage, opponent_rolling_true_shooting_percentage, team_rolling_turnover_percentage, opponent_rolling_turnover_percentage, team_dummy_home_away, TeamResult) </span></code></pre></div>
<p>Per usual, we split our data into training and testing.</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="xgboost-to-make-classifications.html#cb212-1" aria-hidden="true" tabindex="-1"></a>game_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(modelgames, <span class="at">prop =</span> .<span class="dv">8</span>)</span>
<span id="cb212-2"><a href="xgboost-to-make-classifications.html#cb212-2" aria-hidden="true" tabindex="-1"></a>game_train <span class="ot">&lt;-</span> <span class="fu">training</span>(game_split)</span>
<span id="cb212-3"><a href="xgboost-to-make-classifications.html#cb212-3" aria-hidden="true" tabindex="-1"></a>game_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(game_split)</span></code></pre></div>
<p>For this walkthrough, we’ll just do XGboost because of the time needed to complete it. We can refer to the previous chapter for comparison.</p>
<p>Our recipe is the same as the previous chapter.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="xgboost-to-make-classifications.html#cb213-1" aria-hidden="true" tabindex="-1"></a>game_recipe <span class="ot">&lt;-</span> </span>
<span id="cb213-2"><a href="xgboost-to-make-classifications.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(TeamResult <span class="sc">~</span> ., <span class="at">data =</span> game_train) <span class="sc">%&gt;%</span> </span>
<span id="cb213-3"><a href="xgboost-to-make-classifications.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(game_id, game_date, team_short_display_name, opponent_short_display_name, season, <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-4"><a href="xgboost-to-make-classifications.html#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb213-5"><a href="xgboost-to-make-classifications.html#cb213-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-6"><a href="xgboost-to-make-classifications.html#cb213-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(game_recipe)</span></code></pre></div>
<pre><code>## # A tibble: 11 × 4
##    variable                                  type    role      source  
##    &lt;chr&gt;                                     &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
##  1 game_id                                   numeric ID        original
##  2 game_date                                 date    ID        original
##  3 team_short_display_name                   nominal ID        original
##  4 opponent_short_display_name               nominal ID        original
##  5 season                                    numeric ID        original
##  6 team_rolling_true_shooting_percentage     numeric predictor original
##  7 opponent_rolling_true_shooting_percentage numeric predictor original
##  8 team_rolling_turnover_percentage          numeric predictor original
##  9 opponent_rolling_turnover_percentage      numeric predictor original
## 10 team_dummy_home_away                      numeric predictor original
## 11 TeamResult                                nominal outcome   original</code></pre>
<p>Similar to last time, we’re going to use a boosted tree function, tune the parameters but this time we’ll set the mode to classification.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="xgboost-to-make-classifications.html#cb215-1" aria-hidden="true" tabindex="-1"></a>xg_mod <span class="ot">&lt;-</span>   <span class="fu">boost_tree</span>(</span>
<span id="cb215-2"><a href="xgboost-to-make-classifications.html#cb215-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> <span class="fu">tune</span>(), </span>
<span id="cb215-3"><a href="xgboost-to-make-classifications.html#cb215-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">learn_rate =</span> <span class="fu">tune</span>(),</span>
<span id="cb215-4"><a href="xgboost-to-make-classifications.html#cb215-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="fu">tune</span>(), </span>
<span id="cb215-5"><a href="xgboost-to-make-classifications.html#cb215-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="fu">tune</span>(),</span>
<span id="cb215-6"><a href="xgboost-to-make-classifications.html#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">loss_reduction =</span> <span class="fu">tune</span>(), </span>
<span id="cb215-7"><a href="xgboost-to-make-classifications.html#cb215-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">tune</span>(), </span>
<span id="cb215-8"><a href="xgboost-to-make-classifications.html#cb215-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">tune</span>(), </span>
<span id="cb215-9"><a href="xgboost-to-make-classifications.html#cb215-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb215-10"><a href="xgboost-to-make-classifications.html#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;classification&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb215-11"><a href="xgboost-to-make-classifications.html#cb215-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;xgboost&quot;</span>, <span class="at">nthread =</span> cores)</span></code></pre></div>
<p>We’ll make our workflow.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="xgboost-to-make-classifications.html#cb216-1" aria-hidden="true" tabindex="-1"></a>xg_wflow <span class="ot">&lt;-</span> </span>
<span id="cb216-2"><a href="xgboost-to-make-classifications.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb216-3"><a href="xgboost-to-make-classifications.html#cb216-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(xg_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb216-4"><a href="xgboost-to-make-classifications.html#cb216-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(game_recipe)</span></code></pre></div>
<p>Establish our grid to start the process of cross validating our model tuning.</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="xgboost-to-make-classifications.html#cb217-1" aria-hidden="true" tabindex="-1"></a>xgb_grid <span class="ot">&lt;-</span> <span class="fu">grid_latin_hypercube</span>(</span>
<span id="cb217-2"><a href="xgboost-to-make-classifications.html#cb217-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">trees</span>(),</span>
<span id="cb217-3"><a href="xgboost-to-make-classifications.html#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tree_depth</span>(),</span>
<span id="cb217-4"><a href="xgboost-to-make-classifications.html#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min_n</span>(),</span>
<span id="cb217-5"><a href="xgboost-to-make-classifications.html#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">loss_reduction</span>(),</span>
<span id="cb217-6"><a href="xgboost-to-make-classifications.html#cb217-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_size =</span> <span class="fu">sample_prop</span>(),</span>
<span id="cb217-7"><a href="xgboost-to-make-classifications.html#cb217-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize</span>(<span class="fu">mtry</span>(), game_train),</span>
<span id="cb217-8"><a href="xgboost-to-make-classifications.html#cb217-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">learn_rate</span>(),</span>
<span id="cb217-9"><a href="xgboost-to-make-classifications.html#cb217-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">30</span></span>
<span id="cb217-10"><a href="xgboost-to-make-classifications.html#cb217-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb217-11"><a href="xgboost-to-make-classifications.html#cb217-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-12"><a href="xgboost-to-make-classifications.html#cb217-12" aria-hidden="true" tabindex="-1"></a>xgb_grid</span></code></pre></div>
<pre><code>## # A tibble: 30 × 7
##    trees tree_depth min_n loss_reduction sample_size  mtry learn_rate
##    &lt;int&gt;      &lt;int&gt; &lt;int&gt;          &lt;dbl&gt;       &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;
##  1   842         13    36       1.83e- 9       0.687     4   1.14e- 8
##  2    25         10    34       1.08e-10       0.837     8   5.58e-10
##  3  1870          9     8       8.15e- 6       0.149     6   2.37e- 3
##  4   171         14    13       7.49e- 5       0.259     3   2.51e- 8
##  5  1974          1    30       3.36e- 4       0.609    11   2.12e- 5
##  6  1242         11    36       5.86e- 1       0.787     7   3.78e- 8
##  7   435          3    17       3.10e- 3       0.936     2   4.65e- 7
##  8   786          9    28       1.71e- 5       0.701     5   9.97e- 8
##  9   316          4    22       7.11e- 9       0.454    11   1.21e- 4
## 10  1802         10    15       1.90e- 7       0.521     5   7.96e- 2
## # … with 20 more rows</code></pre>
<p>Speaking of cross-validation …</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="xgboost-to-make-classifications.html#cb219-1" aria-hidden="true" tabindex="-1"></a>game_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(game_train)</span>
<span id="cb219-2"><a href="xgboost-to-make-classifications.html#cb219-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-3"><a href="xgboost-to-make-classifications.html#cb219-3" aria-hidden="true" tabindex="-1"></a>game_folds</span></code></pre></div>
<pre><code>## #  10-fold cross-validation 
## # A tibble: 10 × 2
##    splits               id    
##    &lt;list&gt;               &lt;chr&gt; 
##  1 &lt;split [39605/4401]&gt; Fold01
##  2 &lt;split [39605/4401]&gt; Fold02
##  3 &lt;split [39605/4401]&gt; Fold03
##  4 &lt;split [39605/4401]&gt; Fold04
##  5 &lt;split [39605/4401]&gt; Fold05
##  6 &lt;split [39605/4401]&gt; Fold06
##  7 &lt;split [39606/4400]&gt; Fold07
##  8 &lt;split [39606/4400]&gt; Fold08
##  9 &lt;split [39606/4400]&gt; Fold09
## 10 &lt;split [39606/4400]&gt; Fold10</code></pre>
<p>And now the part that makes laptop fans go wheeee – tuning the model.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="xgboost-to-make-classifications.html#cb221-1" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(<span class="at">cores =</span> cores)</span>
<span id="cb221-2"><a href="xgboost-to-make-classifications.html#cb221-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-3"><a href="xgboost-to-make-classifications.html#cb221-3" aria-hidden="true" tabindex="-1"></a>xgb_res <span class="ot">&lt;-</span> <span class="fu">tune_grid</span>(</span>
<span id="cb221-4"><a href="xgboost-to-make-classifications.html#cb221-4" aria-hidden="true" tabindex="-1"></a>  xg_wflow,</span>
<span id="cb221-5"><a href="xgboost-to-make-classifications.html#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">resamples =</span> game_folds,</span>
<span id="cb221-6"><a href="xgboost-to-make-classifications.html#cb221-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">grid =</span> xgb_grid,</span>
<span id="cb221-7"><a href="xgboost-to-make-classifications.html#cb221-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb221-8"><a href="xgboost-to-make-classifications.html#cb221-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb221-9"><a href="xgboost-to-make-classifications.html#cb221-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-10"><a href="xgboost-to-make-classifications.html#cb221-10" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">stopImplicitCluster</span>()</span>
<span id="cb221-11"><a href="xgboost-to-make-classifications.html#cb221-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-12"><a href="xgboost-to-make-classifications.html#cb221-12" aria-hidden="true" tabindex="-1"></a>xgb_res</span></code></pre></div>
<pre><code>## # Tuning results
## # 10-fold cross-validation 
## # A tibble: 10 × 5
##    splits               id     .metrics           .notes           .predictions 
##    &lt;list&gt;               &lt;chr&gt;  &lt;list&gt;             &lt;list&gt;           &lt;list&gt;       
##  1 &lt;split [39605/4401]&gt; Fold01 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  2 &lt;split [39605/4401]&gt; Fold02 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  3 &lt;split [39605/4401]&gt; Fold03 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  4 &lt;split [39605/4401]&gt; Fold04 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  5 &lt;split [39605/4401]&gt; Fold05 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  6 &lt;split [39605/4401]&gt; Fold06 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  7 &lt;split [39606/4400]&gt; Fold07 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  8 &lt;split [39606/4400]&gt; Fold08 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
##  9 &lt;split [39606/4400]&gt; Fold09 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…
## 10 &lt;split [39606/4400]&gt; Fold10 &lt;tibble [60 × 11]&gt; &lt;tibble [0 × 1]&gt; &lt;tibble [132…</code></pre>
<p>We’ll cut to the chase and go straight to the best by accuracy.</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb223-1"><a href="xgboost-to-make-classifications.html#cb223-1" aria-hidden="true" tabindex="-1"></a>best_acc <span class="ot">&lt;-</span> <span class="fu">select_best</span>(xgb_res, <span class="st">&quot;accuracy&quot;</span>)</span></code></pre></div>
<p>We’ll create our final workflow and fit the model.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="xgboost-to-make-classifications.html#cb224-1" aria-hidden="true" tabindex="-1"></a>final_xgb <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(</span>
<span id="cb224-2"><a href="xgboost-to-make-classifications.html#cb224-2" aria-hidden="true" tabindex="-1"></a>  xg_wflow,</span>
<span id="cb224-3"><a href="xgboost-to-make-classifications.html#cb224-3" aria-hidden="true" tabindex="-1"></a>  best_acc</span>
<span id="cb224-4"><a href="xgboost-to-make-classifications.html#cb224-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="xgboost-to-make-classifications.html#cb225-1" aria-hidden="true" tabindex="-1"></a>xg_fit <span class="ot">&lt;-</span> </span>
<span id="cb225-2"><a href="xgboost-to-make-classifications.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  final_xgb <span class="sc">%&gt;%</span> </span>
<span id="cb225-3"><a href="xgboost-to-make-classifications.html#cb225-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> game_train)</span></code></pre></div>
<pre><code>## [23:04:54] WARNING: amalgamation/../src/learner.cc:1115: Starting in XGBoost 1.3.0, the default evaluation metric used with the objective &#39;binary:logistic&#39; was changed from &#39;error&#39; to &#39;logloss&#39;. Explicitly set eval_metric if you&#39;d like to restore the old behavior.</code></pre>
<p>Now to see how our model fared against training data.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="xgboost-to-make-classifications.html#cb227-1" aria-hidden="true" tabindex="-1"></a>trainresults <span class="ot">&lt;-</span> game_train <span class="sc">%&gt;%</span></span>
<span id="cb227-2"><a href="xgboost-to-make-classifications.html#cb227-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(xg_fit, game_train))</span>
<span id="cb227-3"><a href="xgboost-to-make-classifications.html#cb227-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-4"><a href="xgboost-to-make-classifications.html#cb227-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(trainresults, <span class="at">truth =</span> TeamResult, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.665
## 2 kap      binary         0.330</code></pre>
<p>We’re up pretty significantly against the random forest without the home and away dummy. But is it stable?</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="xgboost-to-make-classifications.html#cb229-1" aria-hidden="true" tabindex="-1"></a>testresults <span class="ot">&lt;-</span> game_test <span class="sc">%&gt;%</span></span>
<span id="cb229-2"><a href="xgboost-to-make-classifications.html#cb229-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">predict</span>(xg_fit, game_test))</span>
<span id="cb229-3"><a href="xgboost-to-make-classifications.html#cb229-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-4"><a href="xgboost-to-make-classifications.html#cb229-4" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(testresults, <span class="at">truth =</span> TeamResult, <span class="at">estimate =</span> .pred_class)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.648
## 2 kap      binary         0.296</code></pre>
<p>Say this for XGBoost: It’s remarkably stable.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="using-random-forests-to-predict-winners.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="support-vector-machines.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/07-xgboost2.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["advancedsportsdataanalysis.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
